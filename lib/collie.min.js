var collie=collie||{};
(function(){collie.version="1.1.0";collie.Class=function(b,c){var d=null;if("$init"in b){d=b.$init;delete b.$init}var e=function(){d!==null&&d.apply(this,arguments)};if(typeof c!=="undefined"){e=function(){c.apply(this,arguments);d!==null&&d.apply(this,arguments)};var f=function(){};f.prototype=c.prototype;e.$super=c.prototype;e.prototype=new f;e.prototype.constructor=e}for(var g in b)if(b.hasOwnProperty(g)&&g!=="prototype")e.prototype[g]=b[g];return e};collie.util=new (collie.Class({$init:function(){this._bSupportCSS3=this._bSupport3d=
this._htDeviceInfo=this._sCSSPrefix=null;this._htBoundary={left:0,right:0,top:0,bottom:0}},getDisplayObjectById:function(b){return collie.DisplayObject.htFactory[b]},getDisplayObjectByName:function(b){for(var c in collie.DisplayObject.htFactory)if(collie.DisplayObject.htFactory[c].get("name")===b)return collie.DisplayObject.htFactory[c];return false},getDeviceInfo:function(b){if(this._htDeviceInfo!==null&&typeof b==="undefined")return this._htDeviceInfo;var c=null,d=false,e=typeof CanvasRenderingContext2D!==
"undefined",f=false,g=false,j=false,k=/chrome/i.test(b)?true:false;b=b||navigator.userAgent;var h=0;if(/android/i.test(b)){f=true;if((c=b.toString().match(/android ([0-9]\.[0-9])\.?([0-9]?)/i))&&c[1])h=(parseFloat(c[1])+(c[2]?c[2]*0.01:0)).toFixed(2)}else if(/(iphone|ipad|ipod)/i.test(b)){g=true;if((c=b.toString().match(/([0-9]_[0-9])/i))&&c[1])h=parseFloat(c[1].replace(/_/,"."))}else{d=true;if(/(MSIE)/i.test(b)){j=true;if((c=b.toString().match(/MSIE ([0-9])/i))&&c[1])h=parseInt(c[1],10)}}return this._htDeviceInfo=
{supportCanvas:e,desktop:d,android:f?h:false,ios:g?h:false,ie:j?h:false,chrome:k}},getCSSPrefix:function(b,c){var d="";if(this._sCSSPrefix===null){this._sCSSPrefix="";if(typeof document.body.style.webkitTransform!=="undefined")this._sCSSPrefix="-webkit-";else if(typeof document.body.style.MozTransform!=="undefined")this._sCSSPrefix="-moz-";else if(typeof document.body.style.OTransform!=="undefined")this._sCSSPrefix="-o-";else if(typeof document.body.style.msTransform!=="undefined")this._sCSSPrefix=
"-ms-"}d=this._sCSSPrefix+(b?b:"");if(c){var e=d.split("-");d="";for(var f=0,g=e.length;f<g;f++)if(e[f])d+=d?e[f].substr(0,1).toUpperCase()+e[f].substr(1):e[f];if(this._sCSSPrefix==="-moz-"||this._sCSSPrefix==="-o-")d=d.substr(0,1).toUpperCase()+d.substr(1)}return d},getSupportCSS3:function(){if(this._bSupportCSS3===null)this._bSupportCSS3=typeof document.body.style[collie.util.getCSSPrefix("transform",true)]!=="undefined"||typeof document.body.style.transform!="undefined";return this._bSupportCSS3},
getSupportCSS3d:function(){if(this._bSupport3d===null)this._bSupport3d=(typeof document.body.style[collie.util.getCSSPrefix("perspective",true)]!=="undefined"||typeof document.body.style.perspective!="undefined")&&(!collie.util.getDeviceInfo().android||collie.util.getDeviceInfo().android>=4);return this._bSupport3d},toRad:function(b){return b*Math.PI/180},toDeg:function(b){return b*180/Math.PI},approximateValue:function(b){return Math.round(b*1E7)/1E7},fixAngle:function(b){b=collie.util.toDeg(b);
b-=Math.floor(b/360)*360;return collie.util.toRad(b)},getDistance:function(b,c,d,e){return Math.sqrt(Math.pow(d-b,2)+Math.pow(e-c,2))},getBoundary:function(b){for(var c=b[0][0],d=b[0][0],e=b[0][1],f=b[0][1],g=1,j=b.length;g<j;g++){c=Math.min(c,b[g][0]);d=Math.max(d,b[g][0]);e=Math.min(e,b[g][1]);f=Math.max(f,b[g][1])}return{left:c,right:d,top:e,bottom:f}},getBoundaryToPoints:function(b){return[[b.left,b.top],[b.right,b.top],[b.right,b.bottom],[b.left,b.bottom]]},queryString:function(){var b={};if(location.search)for(var c=
location.search.substr(1).split("&"),d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[f.shift()]=f.join("=")}return b},cloneObject:function(b){var c={},d;for(d in b)c[d]=b[d];return c},pushWithSort:function(b,c){for(var d=false,e=0,f=b.length;e<f;e++)if(b[e]._htOption.zIndex>c._htOption.zIndex){b.splice(e,0,c);d=true;break}d||b.push(c)},addEventListener:function(b,c,d,e){"addEventListener"in b?b.addEventListener(c,d,e):b.attachEvent("on"+c,d,e)},removeEventListener:function(b,c,d,e){"removeEventListener"in
b?b.removeEventListener(c,d,e):b.detachEvent("on"+c,d,e)},stopEventDefault:function(b){b=b||window.event;"preventDefault"in b&&b.preventDefault();b.returnValue=false},getPosition:function(b){var c=b.ownerDocument||b.document||document,d=c.documentElement,e=c.body;c={};if("getBoundingClientRect"in b){b=b.getBoundingClientRect();c.x=b.left;c.x+=d.scrollLeft||e.scrollLeft;c.y=b.top;c.y+=d.scrollTop||e.scrollTop;c.width=b.width;c.height=b.height}else{c.x=0;c.y=0;c.width=b.offsetWidth;c.height=b.offsetHeight;
for(d=b;d;d=d.offsetParent){c.x+=d.offsetLeft;c.y+=d.offsetTop}for(d=b.parentNode;d;d=d.parentNode){if(d.tagName==="BODY")break;if(d.tagName==="TR")c.y+=2;c.x-=d.scrollLeft;c.y-=d.scrollTop}}return c}}));collie.util.getDeviceInfo().ios&&window.addEventListener("load",function(){setTimeout(function(){document.body.scrollTop=0},300)});if(!Function.prototype.bind)Function.prototype.bind=function(b){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var c=Array.prototype.slice.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e?this:b,c.concat(Array.prototype.slice.call(arguments)))};e.prototype=this.prototype;f.prototype=new e;return f};var a=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;if(a&&a.lineTo){a._dashedLineProperty={index:0,length:0};a.resetDashedLine=function(){this._dashedLineProperty={index:0,length:0}};a.dashedLine=function(b,c,d,e,f,g){f||(f=[10,5]);d-=b;var j=e-c;e=Math.sqrt(d*
d+j*j);d=Math.atan2(j,d);j=f.length;for(var k=this._dashedLineProperty.index||0,h=this._dashedLineProperty.length||0,m=0,l=0;e>h;){if(m!==0||h===0)h+=f[k++%j]*g;if(h>e){this._dashedLineProperty.length=h-e;h=e}m=b+h*Math.cos(d);l=c+h*Math.sin(d);k%2===1?this.lineTo(m,l):this.moveTo(m,l)}this._dashedLineProperty.index=k}}collie.raphaelDashArray={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]}})();
collie.Effect=function(a){if(this instanceof arguments.callee)throw Error("You can't create a instance of this");var b=/^(\-?[0-9\.]+)(%|px|pt|em)?$/,c=/^rgb\(([0-9]+)\s?,\s?([0-9]+)\s?,\s?([0-9]+)\)$/i,d=/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,e=/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i,f=function(g){var j=g,k;if(b.test(g)){j=parseFloat(g);k=RegExp.$2||""}else if(c.test(g)){j=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)];k="color"}else if(d.test(g.replace(e,"#$1$1$2$2$3$3"))){j=
[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)];k="color"}return{nValue:j,sUnit:k}};return function(g,j){var k;if(arguments.length>1){g=f(g);j=f(j)}else{j=f(g);g=null}k=j.sUnit;if(g&&j&&g.sUnit!=j.sUnit)throw Error("unit error");g=g&&g.nValue;j=j&&j.nValue;var h=function(m){var l=a(m);if(k=="color"){m=Math.max(0,Math.min(255,parseInt((j[0]-g[0])*l+g[0]+k,10)))<<16;m|=Math.max(0,Math.min(255,parseInt((j[1]-g[1])*l+g[1]+k,10)))<<8;m|=Math.max(0,Math.min(255,parseInt((j[2]-g[2])*
l+g[2]+k,10)));m=m.toString(16).toUpperCase();for(l=0;6-m.length;l++)m="0"+m;return"#"+m}return(j-g)*l+g+k};if(g===null)h.setStart=function(m){m=f(m);if(m.sUnit!=k)throw Error("unit eror");g=m.nValue};return h}};collie.Effect.linear=collie.Effect(function(a){return a});collie.Effect.easeInSine=collie.Effect(function(a){return a==1?1:-Math.cos(a*(Math.PI/2))+1});collie.Effect.easeOutSine=collie.Effect(function(a){return Math.sin(a*(Math.PI/2))});
collie.Effect.easeInOutSine=collie.Effect(function(a){return a<0.5?collie.Effect.easeInSine(0,1)(2*a)*0.5:collie.Effect.easeOutSine(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInSine=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutSine(0,1)(2*a)*0.5:collie.Effect.easeInSine(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInQuad=collie.Effect(function(a){return a*a});collie.Effect.easeOutQuad=collie.Effect(function(a){return-(a*(a-2))});
collie.Effect.easeInOutQuad=collie.Effect(function(a){return a<0.5?collie.Effect.easeInQuad(0,1)(2*a)*0.5:collie.Effect.easeOutQuad(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInQuad=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutQuad(0,1)(2*a)*0.5:collie.Effect.easeInQuad(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInCubic=collie.Effect(function(a){return Math.pow(a,3)});collie.Effect.easeOutCubic=collie.Effect(function(a){return Math.pow(a-1,3)+1});
collie.Effect.easeInOutCubic=collie.Effect(function(a){return a<0.5?collie.Effect.easeIn(0,1)(2*a)*0.5:collie.Effect.easeOut(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInCubic=collie.Effect(function(a){return a<0.5?collie.Effect.easeOut(0,1)(2*a)*0.5:collie.Effect.easeIn(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInQuart=collie.Effect(function(a){return Math.pow(a,4)});collie.Effect.easeOutQuart=collie.Effect(function(a){return-(Math.pow(a-1,4)-1)});
collie.Effect.easeInOutQuart=collie.Effect(function(a){return a<0.5?collie.Effect.easeInQuart(0,1)(2*a)*0.5:collie.Effect.easeOutQuart(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInQuart=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutQuart(0,1)(2*a)*0.5:collie.Effect.easeInQuart(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInQuint=collie.Effect(function(a){return Math.pow(a,5)});collie.Effect.easeOutQuint=collie.Effect(function(a){return Math.pow(a-1,5)+1});
collie.Effect.easeInOutQuint=collie.Effect(function(a){return a<0.5?collie.Effect.easeInQuint(0,1)(2*a)*0.5:collie.Effect.easeOutQuint(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInQuint=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutQuint(0,1)(2*a)*0.5:collie.Effect.easeInQuint(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInCircle=collie.Effect(function(a){return-(Math.sqrt(1-a*a)-1)});collie.Effect.easeOutCircle=collie.Effect(function(a){return Math.sqrt(1-(a-1)*(a-1))});
collie.Effect.easeInOutCircle=collie.Effect(function(a){return a<0.5?collie.Effect.easeInCircle(0,1)(2*a)*0.5:collie.Effect.easeOutCircle(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInCircle=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutCircle(0,1)(2*a)*0.5:collie.Effect.easeInCircle(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInBack=collie.Effect(function(a){return a==1?1:a/1*(a/1)*(2.70158*a-1.70158)});
collie.Effect.easeOutBack=collie.Effect(function(a){return a===0?0:(a=a/1-1)*a*(2.70158*a+1.70158)+1});collie.Effect.easeInOutBack=collie.Effect(function(a){return a<0.5?collie.Effect.easeInBack(0,1)(2*a)*0.5:collie.Effect.easeOutBack(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeInElastic=collie.Effect(function(a){var b=0,c=0;if(a===0)return 0;if((a/=1)==1)return 1;b||(b=0.3);if(!c||c<1)c=1;return-(c*Math.pow(2,10*(a-=1))*Math.sin((a-1)*2*Math.PI/b))});
collie.Effect.easeOutElastic=collie.Effect(function(a){var b=0,c=0,d;if(a===0)return 0;if((a/=1)==1)return 1;b||(b=0.3);if(!c||c<1){c=1;d=b/4}else d=b/(2*Math.PI)*Math.asin(1/c);return c*Math.pow(2,-10*a)*Math.sin((a-d)*2*Math.PI/b)+1});
collie.Effect.easeInOutElastic=collie.Effect(function(a){var b=0,c=0,d;if(a===0)return 0;if((a/=0.5)==2)return 1;b||(b=0.3*1.5);if(!c||c<1){c=1;d=b/4}else d=b/(2*Math.PI)*Math.asin(1/c);if(a<1)return-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-d)*2*Math.PI/b);return c*Math.pow(2,-10*(a-=1))*Math.sin((a-d)*2*Math.PI/b)*0.5+1});
collie.Effect.easeOutBounce=collie.Effect(function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375});collie.Effect.easeInBounce=collie.Effect(function(a){return 1-collie.Effect.easeOutBounce(0,1)(1-a)});collie.Effect.easeInOutBounce=collie.Effect(function(a){return a<0.5?collie.Effect.easeInBounce(0,1)(2*a)*0.5:collie.Effect.easeOutBounce(0,1)(2*a-1)*0.5+0.5});
collie.Effect.easeInExpo=collie.Effect(function(a){return a===0?0:Math.pow(2,10*(a-1))});collie.Effect.easeOutExpo=collie.Effect(function(a){return a==1?1:-Math.pow(2,-10*a/1)+1});collie.Effect.easeInOutExpo=collie.Effect(function(a){return a<0.5?collie.Effect.easeInExpo(0,1)(2*a)*0.5:collie.Effect.easeOutExpo(0,1)(2*a-1)*0.5+0.5});collie.Effect.easeOutInExpo=collie.Effect(function(a){return a<0.5?collie.Effect.easeOutExpo(0,1)(2*a)*0.5:collie.Effect.easeInExpo(0,1)(2*a-1)*0.5+0.5});
collie.Effect._cubicBezier=function(a,b,c,d){return function(e){var f=3*a,g=3*(c-a)-f,j=1-f-g,k=3*b,h=3*(d-b)-k,m=1-k-h;return function(l){return((m*l+h)*l+k)*l}(function(l,q){var n,p,o,r;o=l;for(p=0;p<8;p++){r=((j*o+g)*o+f)*o-l;if(Math.abs(r)<q)return o;n=(3*j*o+2*g)*o+f;if(Math.abs(n)<1.0E-6)break;o-=r/n}n=0;p=1;o=l;if(o<n)return n;if(o>p)return p;for(;n<p;){r=((j*o+g)*o+f)*o;if(Math.abs(r-l)<q)break;if(l>r)n=o;else p=o;o=(p-n)*0.5+n}return o}(e,0.0050))}};
collie.Effect.cubicBezier=function(a,b,c,d){return collie.Effect(collie.Effect._cubicBezier(a,b,c,d))};collie.Effect.cubicEase=collie.Effect.cubicBezier(0.25,0.1,0.25,1);collie.Effect.cubicEaseIn=collie.Effect.cubicBezier(0.42,0,1,1);collie.Effect.cubicEaseOut=collie.Effect.cubicBezier(0,0,0.58,1);collie.Effect.cubicEaseInOut=collie.Effect.cubicBezier(0.42,0,0.58,1);collie.Effect.cubicEaseOutIn=collie.Effect.cubicBezier(0,0.42,1,0.58);
collie.Effect.overphase=collie.Effect(function(a){a/=0.652785;return(Math.sqrt((2-a)*a)+0.1*a).toFixed(5)});collie.Effect.sinusoidal=collie.Effect(function(a){return-Math.cos(a*Math.PI)/2+0.5});collie.Effect.mirror=collie.Effect(function(a){return a<0.5?collie.Effect.sinusoidal(0,1)(a*2):collie.Effect.sinusoidal(0,1)(1-(a-0.5)*2)});collie.Effect.pulse=function(a){return collie.Effect(function(b){return-Math.cos(b*(a-0.5)*2*Math.PI)/2+0.5})};
collie.Effect.wave=function(a,b){return collie.Effect(function(c){return(b||1)*Math.sin(a*c*360*Math.PI/180).toFixed(5)})};collie.Effect.easeIn=collie.Effect.easeInCubic;collie.Effect.easeOut=collie.Effect.easeOutCubic;collie.Effect.easeInOut=collie.Effect.easeInOutCubic;collie.Effect.easeOutIn=collie.Effect.easeOutInCubic;collie.Effect.bounce=collie.Effect.easeOutBounce;collie.Effect.elastic=collie.Effect.easeInElastic;
collie.Component=collie.Class({$init:function(){this._bInitOption=false;this._htOption={};this._htOptionSetter={};this._htHandler={}},option:function(a,b,c){if(typeof a==="object")if(this._bInitOption)for(var d in a)this.option(d,a[d],c);else{this._htOption=collie.util.cloneObject(a);this._bInitOption=true}else if(typeof a==="string")if(b!==undefined){if(!c||typeof this._htOption[a]==="undefined"){this._htOption[a]=b;if(this._htOptionSetter[a]!==undefined)this._htOptionSetter[a](b);this._bInitOption=
true}}else return this._htOption[a];else return this._htOption},get:function(a){return this.option(a)},set:function(a,b,c){this.option(a,b,c);return this},unset:function(a){this._htOption&&typeof this._htOption[a]!=="undefined"&&delete this._htOption[a]},optionSetter:function(a,b){this._htOptionSetter[a]=b},fireEvent:function(a,b){if(typeof this._htHandler[a]!=="undefined"&&this._htHandler[a].length>0){b=b||{};oCustomEvent=new collie.ComponentEvent(a,b);for(var c=false,d=0,e=this._htHandler[a].concat().length;d<
e;d++){this._htHandler[a][d](oCustomEvent);if(oCustomEvent.isStop())c=true}if(c)return false}return true},attach:function(a,b){if(typeof a!=="string")for(var c in a)this.attach(c,a[c]);else{this._htHandler[a]=this._htHandler[a]||[];var d=this._htHandler[a];if(!b)return this;c=0;for(var e=d.length;c<e;c++)if(d[c]===b)return this;d.push(b)}return this},detach:function(a,b){if(typeof a!=="string")for(var c in a)this.detach(c,a[c]);else if(this._htHandler[a]!==undefined){var d=this._htHandler[a];if(b){c=
0;for(var e=d.length;c<e;c++)if(d[c]===b){this._htHandler[a].splice(c,1);this._htHandler[a].length<1&&delete this._htHandler[a];break}}else delete this._htHandler[a]}},detachAll:function(a){if(a){if(this._htHandler[a]!==undefined)this._htHandler[a]=[]}else this._htHandler={}}});collie.ComponentEvent=collie.Class({$init:function(a,b){this.type=a;this._bCanceled=false;if(b)for(var c in b)this[c]=b[c]},stop:function(){this._bCanceled=true},isStop:function(){return this._bCanceled}});
collie.SpriteSheet=collie.Class({$init:function(){this._htSpriteSheet={}},add:function(a,b,c,d,e,f,g){if(typeof b==="object")if(b instanceof Array)for(var j=0,k=b.length;j<k;j++)this.add.apply(this,[a,j].concat(b[j]));else for(j in b)this.add.apply(this,[a,j].concat(b[j]));else{this._htSpriteSheet[a]=this._htSpriteSheet[a]||{};if(typeof e!=="undefined")collie.ImageManager.getImage(a,function(h){this._addWithSpriteLength(h,a,b,c,d,e,f,g)}.bind(this));else this._htSpriteSheet[a][b]=[c,d]}},_addWithSpriteLength:function(a,
b,c,d,e,f,g,j){b=this._htSpriteSheet[b][c]=[];c=a.width;a=a.height;if(collie.Renderer.isRetinaDisplay()){c/=2;a/=2}for(i=0;i<j;i++){if(d>=c){d=0;e+=g}if(e>=a)break;b.push([d,e]);d+=f}},remove:function(a){this._htSpriteSheet[a]&&delete this._htSpriteSheet[a]},get:function(a){return this._htSpriteSheet[a]?this._htSpriteSheet[a]:false},reset:function(){this._htSpriteSheet={}}});
collie.ImageManager=collie.ImageManager||new (collie.Class({RETRY_COUNT:3,RETRY_DELAY:500,USE_PRERENDERING_DOM:false,$init:function(){this._aImages=[];this._htImageNames={};this._htImageRetryCount={};this._htImageWhileLoading={};this._nCount=0;this._oSpriteSheet=new collie.SpriteSheet},_addImage:function(a,b){var c=this._aImages.push({element:a,name:b}),d=this._htImageNames[b];this._htImageNames[b]=c-1;delete this._htImageRetryCount[b];if(d&&d instanceof Array)for(var e=0,f=d.length;e<f;e++)d[e](a,
b);this.fireEvent("process",{name:b,url:a.src,count:c,total:this._nCount,ratio:Math.round(c/this._nCount*1E3)/1E3});this._nCount===c&&this.fireEvent("complete")},_markImage:function(a){this._htImageNames[a]||(this._htImageNames[a]=[]);this._htImageRetryCount[a]||(this._htImageRetryCount[a]=0)},_makeHash:function(){this._htImageNames={};for(var a=0,b=this._aImages.length;a<b;a++)this._htImageNames[this._aImages[a].name]=a},getImage:function(a,b){if(!a&&a!==0)return false;a in this._htImageNames||this._markImage(a);
if(this._htImageNames[a]instanceof Array)return b&&this._addMarkCallback(a,b);else if(b)b(this._aImages[this._htImageNames[a]].element);else return this._aImages[this._htImageNames[a]].element},_addMarkCallback:function(a,b,c){if(a in this._htImageNames&&this._htImageNames[a]instanceof Array){c&&this.attach("error",function d(e){if(e.name===a){c();this.detach("error",d)}});b&&this._htImageNames[a].push(b);return true}else return false},removeImage:function(a){if(!(a in this._htImageNames))return false;
var b=this._aImages.splice(this._htImageNames[a],1);this._makeHash();b.onload=null;b.onerror=null;b.src=null;this._oSpriteSheet.remove(a)},remove:function(a){this.removeImage(a)},add:function(){typeof arguments[0]==="object"?this.addImages.apply(this,arguments):this.addImage.apply(this,arguments)},addImages:function(a,b,c){var d=null,e=null,f=0,g=0,j=[],k;for(k in a)f++;if(b&&b!==null)d=function(){g++;g>=f&&b(a)}.bind(this);if(c&&c!==null)e=function(h,m,l){j.push([h,m,l]);j.length+g>=f&&c(j)}.bind(this);
for(k in a)this.addImage(k,a[k],d,e)},addImage:function(a,b,c,d){if(this.getImage(a))c&&c!==null&&c(this.getImage(a),a,b);else if(!(a in this._htImageWhileLoading&&this._addMarkCallback(a,c,d))){this._nCount++;this._markImage(a);var e=new Image;if(this.USE_PRERENDERING_DOM&&collie.Renderer.getRenderingMode()==="dom"&&collie.util.getSupportCSS3d()&&!collie.util.getDeviceInfo().android){e.style.webkitTransform="translateZ(0)";e.style.position="absolute";e.style.visibility="hidden";collie.Renderer.getElement().appendChild(e)}this._htImageWhileLoading[a]=
e;e.onload=function(){this._addImage(e,a);c&&c!==null&&c(e,a,b);e.onerror=e.onload=null;this._deleteWhileLoading(a)}.bind(this);e.onerror=function(){if(this._htImageRetryCount[a]<this.RETRY_COUNT){this._htImageRetryCount[a]++;this.fireEvent("retry",{count:this._aImages.length,total:this._nCount,name:a,url:b,delay:this.RETRY_DELAY,retryCount:this._htImageRetryCount[a]});setTimeout(function(){e.src="about:blank";e.src=b},this.RETRY_DELAY)}else{d&&d!==null&&d(e,a,b);this.fireEvent("error",{count:this._aImages.length,
total:this._nCount,name:a,url:b});e.onerror=e.onload=null;this._deleteWhileLoading(a)}}.bind(this);e.src=b}},_deleteWhileLoading:function(a){delete this._htImageWhileLoading[a]},abort:function(){for(var a in this._htImageWhileLoading){this._htImageWhileLoading[a].onload=this._htImageWhileLoading[a].onerror=null;this._htImageWhileLoading[a].src=null;this._htImageWhileLoading[a]=null}this._htImageWhileLoading={};this._htImageStartedLoading={}},reset:function(){this.abort();this._aImages=[];this._htImageNames=
{};this._htImageRetryCount={};this._htImageWhileLoading={};this._nCount=0;this._oSpriteSheet.reset()},cancelGetImage:function(a,b){if(this._htImageNames[a]instanceof Array)for(var c=0,d=this._htImageNames[a].length;c<d;c++)if(this._htImageNames[a][c]===b){this._htImageNames[a].splice(c,1);break}},addSprite:function(a,b,c,d){this._oSpriteSheet.add(a,b,c,d)},getSprite:function(a){return this._oSpriteSheet.get(a)},removeSprite:function(a){this._oSpriteSheet.remove(a)}},collie.Component));
collie.Matrix={multiple:function(a,b){for(var c=[],d=0,e=b.length;d<e;d++){for(var f=[],g=0,j=b[0].length;g<j;g++){for(var k=0,h=0,m=a[0].length;h<m;h++)k+=a[d][h]*b[h][g];f.push(k)}c.push(f)}return c},translate:function(a,b){return[[1,0,a],[0,1,b],[0,0,1]]},scale:function(a,b){return[[a,0,0],[0,b,0],[0,0,1]]},rotate:function(a){var b=collie.util.toRad(a);a=Math.cos(b);b=Math.sin(b);return[[a,-b,0],[b,a,0],[0,0,1]]},transform:function(a,b,c){a=this.multiple(a,[[b],[c],[1]]);return{x:a[0][0],y:a[1][0]}}};
collie.Transform={_htBoundary:{left:0,top:0,right:0,bottom:0},_bIsIEUnder8:collie.util.getDeviceInfo().ie&&collie.util.getDeviceInfo().ie<9,getBoundary:function(a,b){var c=a.get();c=this.points(a,[[0,0],[c.width,0],[c.width,c.height],[0,c.height]]);var d=collie.util.getBoundary(c);this._htBoundary.left=d.left;this._htBoundary.right=d.right;this._htBoundary.bottom=d.bottom;this._htBoundary.top=d.top;this._htBoundary.isTransform=this.isUseTransform(a);if(b)this._htBoundary.points=c;return this._htBoundary},
points:function(a,b){var c;this._bIsIEUnder8||(c=this.getMatrixRecusively(a));if(!c)return b;for(var d=[],e=0,f=b.length;e<f;e++){var g=collie.Matrix.transform(c,b[e][0],b[e][1]);d.push([g.x,g.y])}return d},getMatrixRecusively:function(a){for(var b=null,c=0,d=0;a;){if(this.isUseTransform(a)){var e=this.getMatrix(a,c,d);b=b!==null?collie.Matrix.multiple(b,e):e}c-=a._htOption.x;d-=a._htOption.y;a=a.getParent()}return b},getMatrix:function(a,b,c){if(typeof b==="undefined")b=0;if(typeof c==="undefined")c=
0;var d=a.getOrigin();a=a.get();var e=collie.Matrix.translate(d.x+b,d.y+c);if(a.angle!==0)e=collie.Matrix.multiple(e,collie.Matrix.rotate(a.angle));if(a.scaleX!==1||a.scaleY!==1)e=collie.Matrix.multiple(e,collie.Matrix.scale(a.scaleX,a.scaleY));return collie.Matrix.multiple(e,collie.Matrix.translate(-(d.x+b),-(d.y+c)))},isUseTransform:function(a){return a._htOption.scaleX!==1||a._htOption.scaleY!==1||a._htOption.angle!==0}};
collie.LayerCanvas=collie.Class({$init:function(a){this._oLayer=a;this._oEvent=a.getEvent();this._htDeviceInfo=collie.util.getDeviceInfo();this._initCanvas()},_initCanvas:function(){var a=this._getLayerSize();this._elCanvas=document.createElement("canvas");this._elCanvas.width=a.width;this._elCanvas.height=a.height;this._elCanvas.className="_collie_layer";this._elCanvas.style.position="absolute";this._elCanvas.style.left=this._oLayer.option("x")+"px";this._elCanvas.style.top=this._oLayer.option("y")+
"px";if(collie.Renderer.isRetinaDisplay()){this._elCanvas.style.width=a.width/2+"px";this._elCanvas.style.height=a.height/2+"px"}this._oContext=this._elCanvas.getContext("2d")},_getLayerSize:function(a,b){a=a||this._oLayer.option("width");b=b||this._oLayer.option("height");if(collie.Renderer.isRetinaDisplay()){a*=2;b*=2}return{width:a,height:b}},getContext:function(){return this._oContext},getElement:function(){return this._elCanvas},clear:function(a){a=a||this.getContext();if(!this._htDeviceInfo.android||
this._htDeviceInfo.android<4.12&&this._htDeviceInfo.android>=4.2)a.clearRect(0,0,this._elCanvas.width+1,this._elCanvas.height+1);else this._elCanvas.width=this._elCanvas.width},resize:function(a,b,c){var d=this._getLayerSize(a,b);if(c){this._elCanvas.style.width=a+"px";this._elCanvas.style.height=b+"px";d=a/this._oLayer.option("width");b/=this._oLayer.option("height");this._oEvent.setEventRatio(d,b)}else{a=typeof a==="number"?d.width:this._elCanvas.width;b=typeof b==="number"?d.height:this._elCanvas.height;
this.clear(this._oContext);this._oLayer.setChanged();this._elCanvas.width=a;this._elCanvas.height=b;if(collie.Renderer.isRetinaDisplay()){this._elCanvas.style.width=a/2+"px";this._elCanvas.style.height=b/2+"px"}}}});
collie.LayerDOM=collie.Class({$init:function(a){this._oLayer=a;this._oEvent=a.getEvent();this._htOption=a.option();this._initElement();this._rxDisplayObjectId=RegExp(collie.DisplayObjectDOM.ID+"([0-9]+)")},_initElement:function(){this._el=document.createElement("div");this._el.className="_collie_layer";this._el.style.position="absolute";this._el.style.left=this._htOption.x+"px";this._el.style.top=this._htOption.y+"px";this._el.style.width=this._htOption.width+"px";this._el.style.height=this._htOption.height+
"px"},findDisplayObjectElement:function(a){for(;a&&a.nodeType==1;){if(this.isDisplayObjectElement(a)&&a.parentNode===this._el)return a;a=a.parentNode}return false},isDisplayObjectElement:function(a){return"classList"in a?a.classList.contains(collie.DisplayObjectDOM.CLASSNAME):(" "+a.className+" ").indexOf(" "+collie.DisplayObjectDOM.CLASSNAME+" ")>-1},getElement:function(){return this._el},clear:function(){return true},resize:function(a,b,c){if(c){a/=this._oLayer.option("width");b/=this._oLayer.option("height");
this._oEvent.setEventRatio(a,b);this._el.style[collie.util.getCSSPrefix("transform-origin",true)]="0 0";if(collie.util.getSupportCSS3d())this._el.style[collie.util.getCSSPrefix("transform",true)]="scale3d("+a+", "+b+", 1)";else if(collie.util.getSupportCSS3())this._el.style[collie.util.getCSSPrefix("transform",true)]="scale("+a+", "+b+")";else this._el.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+a+",M12=0,M21=0,M22="+b+");"}else{this._el.style.width=a+"px";
this._el.style.height=b+"px"}}});
collie.LayerEvent=collie.Class({THRESHOLD_CLICK:7,$init:function(a){this._oLayer=a;this._bHasTouchEvent=!!("ontouchstart"in window);this._fOnEvent=this._onEvent.bind(this);this._oMousedownObject=null;this._htEventRatio={width:1,height:1};this._bAttached=false},attachEvent:function(){var a=this._oLayer.getParent();if(this._bHasTouchEvent){collie.util.addEventListener(a,"touchstart",this._fOnEvent);collie.util.addEventListener(a,"touchend",this._fOnEvent);collie.util.addEventListener(a,"touchmove",
this._fOnEvent);collie.util.addEventListener(a,"touchcancel",this._fOnEvent)}else{collie.util.addEventListener(a,"mousedown",this._fOnEvent);collie.util.addEventListener(a,"mouseup",this._fOnEvent);collie.util.addEventListener(a,"mousemove",this._fOnEvent)}this._bAttached=true},detachEvent:function(){var a=this._oLayer.getParent();if(this._bAttached){if(this._bHasTouchEvent){collie.util.removeEventListener(a,"touchstart",this._fOnEvent);collie.util.removeEventListener(a,"touchend",this._fOnEvent);
collie.util.removeEventListener(a,"touchmove",this._fOnEvent);collie.util.removeEventListener(a,"touchcancel",this._fOnEvent)}else{collie.util.removeEventListener(a,"mousedown",this._fOnEvent);collie.util.removeEventListener(a,"mouseup",this._fOnEvent);collie.util.removeEventListener(a,"mousemove",this._fOnEvent)}this._bAttached=false}},_onEvent:function(a){if(this._oLayer._htOption.useEvent){a=a||window.event;var b=this._bHasTouchEvent?a.changedTouches[0]:a||window.event,c=(this._bHasTouchEvent?
this._getEventTargetElement(a):a.target||a.srcElement).ownerDocument||document,d=c.body||c.documentElement,e=this._bHasTouchEvent?b.pageX:b.pageX||b.clientX+d.scrollLeft-c.body.clientLeft;c=this._bHasTouchEvent?b.pageY:b.pageY||b.clientY+d.scrollTop-c.body.clientTop;b=a.type;d=this._oLayer.getParentPosition();e=e-d.x-this._oLayer._htOption.x;c=c-d.y-this._oLayer._htOption.y;e/=this._htEventRatio.width;c/=this._htEventRatio.height;if(b==="touchcancel")if(this._htEventStartPos!==null){e=this._htEventStartPos.x;
c=this._htEventStartPos.y}b=this._convertEventType(b);if(b==="mousemove"||b==="mousedown")collie.Renderer.isPreventDefault()&&collie.util.stopEventDefault(a);if(b==="mousedown")this._htEventStartPos={x:e,y:c};d=this._fireEvent(a,b,e,c);if(b==="mouseup"){var f=this.THRESHOLD_CLICK,g=this.THRESHOLD_CLICK;this._htEventStartPos&&this._htEventStartPos.x-f<=e&&e<=this._htEventStartPos.x+f&&this._htEventStartPos.y-g<=c&&c<=this._htEventStartPos.y+g&&this._fireEvent(a,"click",e,c);this._htEventStartPos=null}collie.Renderer.setEventStatus(b,
d)}},_fireEvent:function(a,b,c,d){var e=null,f=true;if(b!=="mousemove"&&!collie.Renderer.isStopEvent(b))if(e=this._getTargetOnHitEvent(this._oLayer.getChildren(),c,d)){f=this._bubbleEvent(e,b,a,c,d);b==="mousedown"&&this._setMousedownObject(e);b==="mouseup"&&this._unsetMousedownObject(e)}if(b==="mouseup"&&this._getMousedownObject()!==null){e=this._getMousedownObject();this._bubbleEvent(e,b,a,c,d);this._unsetMousedownObject(e)}f&&this._oLayer.fireEvent(b,{event:a,displayObject:e,x:c,y:d});return!!e},
_getTargetOnHitEvent:function(a,b,c){var d=null;if(a instanceof Array)for(var e=a.length-1;e>=0;e--){if(a[e].hasChild())if(d=this._getTargetOnHitEvent(a[e].getChildren(),b,c))return d;if(d=this._getTargetOnHitEvent(a[e],b,c))return d}else return this._isPointInDisplayObjectBoundary(a,b,c)?a:false},_convertEventType:function(a){var b=a;switch(a){case "touchstart":b="mousedown";break;case "touchmove":b="mousemove";break;case "touchend":case "touchcancel":b="mouseup";break;case "tap":b="click"}return b},
_getEventTargetElement:function(a){for(a=a.target;a.nodeType!=1;)a=a.parentNode;return a},_bubbleEvent:function(a,b,c,d,e,f){if(a.fireEvent(b,{displayObject:f||a,event:c,x:d,y:e})===false)return false;if(a.getParent()&&!this._bubbleEvent(a.getParent(),b,c,d,e,a))return false;return true},_isPointInDisplayObjectBoundary:function(a,b,c){if(!a._htOption.useEvent||!a._htOption.visible||!a._htOption.width||!a._htOption.height||a._htOption.useEvent==="auto"&&!a.hasAttachedHandler())return false;var d=a.getHitAreaBoundary();
if(d.left<=b&&b<=d.right&&d.top<=c&&c<=d.bottom)if(a._htOption.hitArea){d=a.getRelatedPosition();b-=d.x;c-=d.y;d=a._htOption.hitArea;d=collie.Transform.points(a,d);return this._isPointInPolygon(d,b,c)}else return true;return false},_isPointInPolygon:function(a,b,c){for(var d=false,e=0,f=a.length-1,g=a.length;e<g;f=e++)if(a[e][1]>c!==a[f][1]>c&&b<(a[f][0]-a[e][0])*(c-a[e][1])/(a[f][1]-a[e][1])+a[e][0])d=!d;return d},_setMousedownObject:function(a){this._oMousedownObject=a},_unsetMousedownObject:function(a){if(this._oMousedownObject===
a)this._oMousedownObject=null},_getMousedownObject:function(){return this._oMousedownObject},setEventRatio:function(a,b){this._htEventRatio.width=a||this._htEventRatio.width;this._htEventRatio.height=b||this._htEventRatio.height},getEventRatio:function(){return this._htEventRatio}});
collie.Layer=collie.Class({type:"layer",$init:function(a){this.option({x:0,y:0,width:320,height:480,useEvent:true,visible:true,freeze:false,renderingMode:"inherit"});this._sAlignTop=this._sAlignLeft=null;if(a!==undefined){if("x"in a&&(a.x==="left"||a.x==="right"||a.x==="center")){this._sAlignLeft=a.x;a.x=0}if("y"in a&&(a.y==="top"||a.y==="bottom"||a.y==="center")){this._sAlignTop=a.y;a.y=0}this.option(a)}this._renderingMode=this._htOption.renderingMode==="inherit"?collie.Renderer.getRenderingMode():
this._htOption.renderingMode;if(this._renderingMode==="canvas"&&!collie.util.getDeviceInfo().supportCanvas)this._renderingMode="dom";this.drawCount=0;this.optionSetter("visible",this._setVisible.bind(this));this._elParent=null;this._bChanged=false;this._aDisplayObjects=[];this._bLoaded=false;this._oEvent=new collie.LayerEvent(this);this._makeDrawing();this._setVisible()},_makeDrawing:function(){this._oDrawing=this._renderingMode==="dom"?new collie.LayerDOM(this):new collie.LayerCanvas(this)},getDrawing:function(){return this._oDrawing},
getRenderingMode:function(){return this._renderingMode},getEvent:function(){return this._oEvent},getParent:function(){return this._elParent||false},load:function(a,b){this.unload();this._bLoaded=true;this._elParent=this._elParent||a;this._elParent.style.width=Math.max(parseInt(this._elParent.style.width||0,10),this.option("width"))+"px";this._elParent.style.height=Math.max(parseInt(this._elParent.style.height||0,10),this.option("height"))+"px";this.getElement().style.zIndex=b;this._sAlignLeft!==null&&
this.offset(this._sAlignLeft,null,true);this._sAlignTop!==null&&this.offset(null,this._sAlignTop,true);this._elParent.appendChild(this.getElement())},unload:function(){if(this.isLoaded()){this._oEvent.detachEvent();this._elParent.removeChild(this.getElement());this._elParent=null;this._bLoaded=false}},attachEvent:function(){this._oEvent.attachEvent()},detachEvent:function(){this._oEvent.detachEvent()},_setVisible:function(){if(this.getElement())this.getElement().style.display=this.option("visible")?
"block":"none"},isLoaded:function(){return this._bLoaded},addChild:function(a){collie.util.pushWithSort(this._aDisplayObjects,a);a.setLayer(this);this.setChanged()},addChildren:function(a){for(var b=0,c=a.length;b<c;b++)this.addChild(a[b])},removeChild:function(a,b){a.unsetLayer();if(typeof b!=="undefined")this._aDisplayObjects.splice(b,1);else for(var c=0,d=this._aDisplayObjects.length;c<d;c++)if(this._aDisplayObjects[c]===a){this._aDisplayObjects.splice(c,1);break}this.setChanged()},removeChildren:function(a){for(var b=
a.length-1;b>=0;b--)a[b]&&this.removeChild(a[b],b)},addTo:function(a){a=a||collie.Renderer;a.addLayer(this);return this},changeDisplayObjectZIndex:function(a){this.removeChild(a);this.addChild(a)},getChildren:function(){return this._aDisplayObjects},hasChild:function(){return this._aDisplayObjects&&this._aDisplayObjects.length>0},setChanged:function(){this._bChanged=true},isChanged:function(){return this._bChanged},unsetChanged:function(){this._bChanged=false},getContext:function(){return"getContext"in
this._oDrawing?this._oDrawing.getContext():false},getElement:function(){return"getElement"in this._oDrawing?this._oDrawing.getElement():false},update:function(a){this.drawCount=0;if(!(!this.isChanged()||this.option("freeze"))){this.clear();this.unsetChanged();for(var b=this.option("width"),c=this.option("height"),d=0,e=this._aDisplayObjects.length;d<e;d++)this._aDisplayObjects[d].update(a,0,0,b,c)}},clear:function(){this._oDrawing.clear()},resize:function(a,b,c){if(!c){this.option("width",a||this._htOption.width);
this.option("height",b||this._htOption.height)}this._oDrawing&&this._oDrawing.resize(a,b,c);if(this._elParent){this._elParent.style.width=Math.max(parseInt(this._elParent.style.width||0,10),a||this.option("width"))+"px";this._elParent.style.height=Math.max(parseInt(this._elParent.style.height||0,10),b||this.option("height"))+"px"}this.fireEvent("resize")},offset:function(a,b,c){var d=this.getElement();if(typeof a!=="undefined"&&a!==null){switch(a){case "left":a=0;break;case "right":a=parseInt(this._elParent.style.width,
10)-this._htOption.width;break;case "center":a=parseInt(this._elParent.style.width,10)/2-this._htOption.width/2}this.option("x",a);d.style.left=a+"px";if(!c)this._sAlignLeft=null}if(typeof b!=="undefined"&&b!==null){switch(b){case "top":b=0;break;case "bottom":b=parseInt(this._elParent.style.height,10)-this._htOption.height;break;case "center":b=parseInt(this._elParent.style.height,10)/2-this._htOption.height/2}this.option("y",b);d.style.top=b+"px";if(!c)this._sAlignTop=null}},setParent:function(a){if(this._bLoaded){this._oEvent.detachEvent();
this._elParent.removeChild(this.getElement());this._elParent=a;this._elParent.appendChild(this.getElement());this._oEvent.attachEvent()}else this._elParent=a},getParentPosition:function(){if(this._elParent!==null)return this._elParent===collie.Renderer.getElement()?collie.Renderer.getPosition():collie.util.getPosition(this._elParent)},clone:function(a){var b=new this.constructor(this._htOption);if(a&&this._aDisplayObjects.length){a=0;for(var c=this._aDisplayObjects.length;a<c;a++)this._aDisplayObjects[a].clone(true).addTo(b)}return b}},
collie.Component);
collie.DisplayObjectCanvas=collie.Class({$init:function(a){this._oDisplayObject=a;this._bUseCache=false;this._oDebugHitArea=null;this._htEvent={};this._oLayer=null;this._htInfo=this._oDisplayObject.get();this._bIsRetinaDisplay=null;this._htInfo.useCache&&this.loadCache()},loadCache:function(){if(!this._bUseCache){this._bUseCache=true;this._elCache=document.createElement("canvas");this._elCache.width=this._htInfo.width;this._elCache.height=this._htInfo.height;this._oContextCache=this._elCache.getContext("2d")}},
unloadCache:function(){if(this._bUseCache){this._elCache=this._oContextCache=null;this._bUseCache=false}},clearCache:function(){if(this._bUseCache){this._oContextCache.clearRect(0,0,this._elCache.width,this._elCache.height);this._elCache.width=this._htInfo.width*(this._bIsRetinaDisplay?2:1);this._elCache.height=this._htInfo.height*(this._bIsRetinaDisplay?2:1)}},drawImage:function(a,b,c,d,e,f,g,j,k){var h=this._oDisplayObject.getImage();if(collie.Renderer.isRetinaDisplay()){i=1;for(len=arguments.length;i<
len;i++)arguments[i]*=2}try{a.drawImage(h,b,c,d,e,f,g,j,k)}catch(m){throw Error("invalid drawImage value : "+b+","+c+","+d+","+e+","+f+","+g+","+j+","+k+","+this._oDisplayObject.getImage().src+", original : "+this._oDisplayObject.getImage().width+","+this._oDisplayObject.getImage().height+",source : "+h.width+","+h.height+", isCached : "+(this._elImageCached!==null?"true":"false"));}},load:function(){this._oLayer=this._oDisplayObject.getLayer();this._oContext=this._oDisplayObject.getLayer().getContext();
this._bIsRetinaDisplay=collie.Renderer.isRetinaDisplay()},unload:function(){this._oContext=this._oLayer=null},draw:function(a,b,c,d,e,f){var g=f?true:false;f=f||this._oContext;var j=this._bUseCache?this._oContextCache:f,k=f,h=this._htInfo;this._oDisplayObject.getDirty();var m=this._oDisplayObject.getOrigin(),l=h.width,q=h.height,n=m.x,p=m.y;m=b;var o=c,r=this._bIsRetinaDisplay?2:1,v=false,s=f;if(h.useCache)f=this._oContextCache;if(this._bIsRetinaDisplay){b*=2;c*=2;n*=2;p*=2;l*=2;q*=2}if(this._bUseCache||
h.scaleX!==1||h.scaleY!==1||h.angle!==0||h.opacity!==1){v=true;if(this._bUseCache)s=!g?this._oContext:k;s.save();s.translate(b+n,c+p);if(h.opacity!==1)s.globalAlpha=s.globalAlpha===0?h.opacity:s.globalAlpha*h.opacity;h.angle!==0&&s.rotate(collie.util.toRad(h.angle));if(h.scaleX!==1||h.scaleY!==1)s.scale(h.scaleX,h.scaleY);s.translate(-n,-p);b=c=0}this._htEvent.displayObject=this;this._htEvent.context=j;this._htEvent.x=b;this._htEvent.y=c;if(!this._bUseCache||this._oDisplayObject.isChanged()&&!this._oDisplayObject.isChanged(true)){this.clearCache();
if(h.backgroundColor){j.fillStyle=h.backgroundColor;j.fillRect(b,c,l,q)}if(this._oDisplayObject.getImage()){this._oDisplayObject.getImage();l=this._oDisplayObject.getImageSize();if(h.backgroundRepeat&&h.backgroundRepeat!=="no-repeat"){q=h.backgroundRepeat==="repeat"||h.backgroundRepeat==="repeat-x"?Math.ceil(h.width/l.width):1;n=h.backgroundRepeat==="repeat"||h.backgroundRepeat==="repeat-y"?Math.ceil(h.height/l.height):1;if(q>0||n>0)for(p=0;p<q;p++)for(var w=0;w<n;w++){var t=p*l.width+l.width,u=w*
l.height+l.height;t=t>h.width?l.width-(t-h.width):l.width;u=u>h.height?l.height-(u-h.height):l.height;this.drawImage(j,0,0,t,u,b/r+p*l.width,c/r+w*l.height,t,u)}}else{q=Math.min(l.width,h.width);n=Math.min(l.height,h.height);this.drawImage(j,h.offsetX,h.offsetY,h.fitImage?l.width:q,h.fitImage?l.height:n,b/r,c/r,h.fitImage?h.width:q,h.fitImage?h.height:n)}}if("onCanvasDraw"in this._oDisplayObject)this._oDisplayObject.onCanvasDraw(this._htEvent)}if(h.debugHitArea&&h.hitArea)if(this._oDebugHitArea===
null){this._oDebugHitArea=(new collie.Polyline({x:0,y:0,width:h.width,height:h.height,strokeColor:h.debugHitArea===true?"yellow":h.debugHitArea,strokeWidth:3})).addTo(this._oDisplayObject);this._oDebugHitArea.setPointData(h.hitArea)}if(this._oDisplayObject.hasChild()&&(!h.useCache||this._oDisplayObject.isChanged()&&!this._oDisplayObject.isChanged(true))){b=this._oDisplayObject.getChildren();c=0;for(j=b.length;c<j;c++){b[c].update(a,h.useCache||v?0:m,h.useCache||v?0:o,d,e,g||h.useCache?f:null);b[c].unsetChanged();
b[c]._resetDirty()}}if(h.useCache)(g?k:this._oContext).drawImage(f.canvas,0,0);this._oLayer.drawCount++;v&&s.restore()}});
collie.DisplayObjectDOM=collie.Class({$init:function(a){this._oDisplayObject=a;this._htInfo=this._oDisplayObject.get();this._elImage=this._oLayer=null;this._aTransformValue=[];this._sTransformValue=null;this._sTransform=collie.util.getCSSPrefix("transform",true);this._sOrigin=collie.util.getCSSPrefix("transform-origin",true);this._bSupportCSS3=collie.util.getSupportCSS3();this._bSupportCSS3d=collie.util.getSupportCSS3d();this._bUseTransform=this._bSupportCSS3||this._bSupportCSS3d;this._htDeviceInfo=
collie.util.getDeviceInfo();this._bIsAndroid=!!this._htDeviceInfo.android;this._nAndroidVersion=this._htDeviceInfo.android;this._bIsIEUnder8=this._htDeviceInfo.ie&&this._htDeviceInfo.ie<9;this._bUseTranslateZ=true;this._bIsRetinaDisplay=null;this._htEvent={};this._oEmptyObject={};this._sCacheTransformValue=null;this._initElement()},_initElement:function(){this._elContainer=document.createElement("div");this._elContainer.id=collie.DisplayObjectDOM.ID+this._oDisplayObject.getId()+(this._htInfo.name?
"_"+this._htInfo.name:"");this._elContainer.className=collie.DisplayObjectDOM.CLASSNAME;this._elContainerStyle=this._elContainer.style;this._elContainerStyle.position="absolute";if(this._bIsIEUnder8){this._elContainerStyle.width=this._htInfo.width+"px";this._elContainerStyle.height=this._htInfo.height+"px"}this._el=document.createElement("div");this._elStyle=this._el.style;if(this._bSupportCSS3d)this._elStyle[this._sTransform]="translateZ(0)";this._elStyle.position="absolute";this._elStyle.width=
this._htInfo.width+"px";this._elStyle.height=this._htInfo.height+"px";this._elStyle.overflow="hidden";this._elContainer.appendChild(this._el)},load:function(){this._oLayer=this._oDisplayObject.getLayer();this._oDisplayObject.getParent()?this._oDisplayObject.getParent().getDrawing().getElement().appendChild(this._elContainer):this._oLayer.getElement().appendChild(this._elContainer);this._bIsRetinaDisplay=collie.Renderer.isRetinaDisplay()},unload:function(){this._oLayer=null;this._elContainer.parentNode.removeChild(this._elContainer)},
getElement:function(){return this._elContainer},getItemElement:function(){return this._el},draw:function(a,b,c){this._htEvent.displayObject=this;this._htEvent.element=this._el;this._htEvent.x=b;this._htEvent.y=c;a=this._htInfo;b=this._oDisplayObject.getDirty()||this._oEmptyObject;c=this._oDisplayObject.getOrigin();if(b.visible)this._elContainerStyle.display=a.visible?"block":"none";if(b.width){this._elStyle.width=a.width+"px";if(this._bIsIEUnder8)this._elContainerStyle.width=a.width+"px"}if(b.height)this._elStyle.height=
a.height+"px";if(b.opacity)if(this._bIsIEUnder8)this._elContainerStyle.filter="alpha(opacity="+a.opacity*100+")";else{this._elContainerStyle.opacity=a.opacity;if(this._elImage&&this._nAndroidVersion&&this._nAndroidVersion>=4.1)this._elImage.style.opacity=a.opacity}if(b.zIndex)this._elContainerStyle.zIndex=a.zIndex;if(b.backgroundColor)this._elStyle.backgroundColor=a.backgroundColor;if(this._bUseTransform)this._aTransformValue.push(this._makeTranslate(a.x,a.y,a.zIndex));else if(b.x||b.y){this._elContainerStyle.left=
a.x+"px";this._elContainerStyle.top=a.y+"px"}if(this._bUseTransform){if(b.originX||b.originY||b.width||b.height)this._elContainerStyle[this._sOrigin]=c.x+"px "+c.y+"px";if(a.angle!==0)this._aTransformValue.push("rotate",this._bSupportCSS3d&&!this._bIsAndroid?"Z":"","(",a.angle,"deg) ");if(a.scaleX!==1||a.scaleY!==1)this._aTransformValue.push("scale(",a.scaleX,", ",a.scaleY,") ")}this._bUseTransform&&this._applyTransform();this._drawImage(a,b);if("onDOMDraw"in this._oDisplayObject)this._oDisplayObject.onDOMDraw(this._htEvent);
this._oLayer.drawCount++},_drawImage:function(a,b){var c=this._oDisplayObject.getImage(),d=a.backgroundRepeat&&a.backgroundRepeat!=="no-repeat",e=0,f=0;if(this._oDisplayObject._htOption.fitImage){e=this._oDisplayObject._htOption.width;f=this._oDisplayObject._htOption.height}else{f=this._oDisplayObject.getImageSize();e=f.width;f=f.height}if(b.backgroundImage||b.backgroundRepeat){if(this._elImage!==null&&(!a.backgroundImage||a.backgroundRepeat&&a.backgroundRepeat!=="no-repeat")){this._el.removeChild(this._elImage);
this._elImage=null}if(a.backgroundImage&&c)if(!d&&a.backgroundImage)if(this._elImage===null){this._elImage=c.cloneNode();c=this._elImage.style;c.position="absolute";c.top=0;c.left=0;c.width=e+"px";c.height=f+"px";c.visibility="visible";if(this._nAndroidVersion&&this._nAndroidVersion>=4.1)c.opacity=a.opacity;if(this._bSupportCSS3d&&this._bUseTranslateZ)c[this._sTransform]="translateZ(0)";this._el.hasChildNodes()?this._el.insertBefore(this._elImage,this._el.childNodes[0]):this._el.appendChild(this._elImage)}else{this._elImage.src=
c.src;c=this._elImage.style;c.width=e+"px";c.height=f+"px";c.visibility="visible"}else if(d){this._elStyle.backgroundImage='url("'+c.src+'")';this._elStyle.backgroundRepeat=a.backgroundRepeat}}if(a.backgroundImage&&this._elImage!==null){if(this._bIsRetinaDisplay&&d&&(b.width||htDirth.height||b.backgroundRepeat||b.backgroundImage))this._elStyle.backgroundSize=a.width+"px "+a.height+"px";if(b.offsetX||b.offsetY)if(this._bUseTransform)this._elImage.style[this._sTransform]=this._makeTranslate(-a.offsetX,
-a.offsetY,1);else{this._elImage.style.left=-a.offsetX+"px";this._elImage.style.top=-a.offsetY+"px"}}},_makeTranslate:function(a,b,c){var d="";if(this._htInfo.angle!==0&&this._bIsAndroid?0:this._bSupportCSS3d)d="translate3d("+a+"px, "+b+"px, "+c+"px) ";else if(this._bSupportCSS3)d="translate("+a+"px, "+b+"px) ";return d},_applyTransform:function(){var a=this._aTransformValue.join("");if(this._sCacheTransformValue!==a){this._sCacheTransformValue=this._elContainerStyle[this._sTransform]=a;if(this._bIsAndroid&&
this._bUseTranslateZ&&this._htInfo.angle!==0){this._elStyle[this._sTransform]="";this._elImage&&this._oDisplayObject.setChanged();this._bUseTranslateZ=false}else if(!this._bUseTranslateZ&&(this._htInfo.angle===0||!this._bIsAndroid)&&this._bSupportCSS3d){this._elStyle[this._sTransform]="translateZ(0)";this._elImage&&this._oDisplayObject.setChanged();this._bUseTranslateZ=true}}this._aTransformValue=[]}},collie.Component);collie.DisplayObjectDOM.CLASSNAME="_collie_displayObject";
collie.DisplayObjectDOM.ID="_collie_displayObject_";
collie.DisplayObject=collie.Class({type:"displayobject",$init:function(a){this._bInitOption=true;this._htOption={name:"",width:"auto",height:"auto",x:0,y:0,zIndex:0,opacity:1,angle:0,scaleX:1,scaleY:1,originX:"center",originY:"center",offsetX:0,offsetY:0,spriteX:null,spriteY:null,spriteLength:0,spriteSheet:null,rangeX:null,rangeY:null,positionRepeat:false,backgroundColor:"",backgroundImage:"",backgroundRepeat:"no-repeat",hitArea:null,debugHitArea:false,useCache:false,useEvent:"auto",fitImage:false,
velocityX:0,velocityY:0,velocityRotate:0,forceX:0,forceY:0,forceRotate:0,mass:1,friction:0,useRealTime:true,visible:true};a&&this.option(a);this._htDirty={};this._htMatrix={};this._sId=++collie.DisplayObject._idx;this._elImage=null;this._aDisplayObjects=[];this._oDrawing=this._oParent=this._oLayer=null;this._bIsSetOption=false;this._bChangedTransforms=this._bChanged=true;this._bCustomSize=false;this._htGetImageData=this._aChangedQueue=null;this._htRelatedPosition={};this._htParentRelatedPosition=
{};this._htBoundary={};this._sRenderingMode=null;this._bRetinaDisplay=collie.Renderer.isRetinaDisplay();this._nPositionBottom=this._nPositionRight=this._oTimerMove=null;this._nImageHeight=this._nImageWidth=0;this._htSpriteSheet=this._htImageSize=null;this._htOrigin={x:0,y:0};this.set(this._htOption);this._bIsSetOption=true},set:function(a,b,c,d){if(typeof a==="object")for(var e in a)this.set(e,a[e]);else{if(this._bIsSetOption&&this._htOption[a]===b)return;if(a==="width"||a==="height")if(b!=="auto")this._bCustomSize=
true;else b=b==="auto"&&this.getImage()!==null?this.getImageSize()[a]:100;this._htOption[a]=b;this.setDirty(a);c||this._setter(a,b);d||this.setChanged(a==="x"||a==="y"||a==="angle"||a==="scaleX"||a==="scaleY"||a==="opacity"?true:false)}return this},_setter:function(a,b){if(a==="zIndex")if(this._oParent)this._oParent.changeDisplayObjectZIndex(this);else this.getLayer()&&this._oLayer.changeDisplayObjectZIndex(this);if(a==="x"||a==="y"){if(typeof b==="string")this.align(a==="x"?b:false,a==="y"?b:false);
this._fixPosition();this.resetPositionCache()}a==="backgroundImage"&&this.setImage(b);if(a==="spriteX"||a==="spriteY"||a==="spriteSheet")this._setSpritePosition(a,b);a==="hitArea"&&b instanceof Array&&this._makeHitAreaBoundary();if(a==="width"||a==="height"||a==="originX"||a==="originY")this._setOrigin();a==="backgroundRepeat"&&b!=="no-repeat"&&this.set("useCache",true);if(a==="useCache"&&this._oDrawing!==null&&this._oDrawing.loadCache)b?this._oDrawing.loadCache():this._oDrawing.unloadCache()},get:function(a){return a?
this._htOption[a]:this._htOption},setDirty:function(a){if(this._htDirty===null)this._htDirty={};if(typeof a==="undefined")for(var b in this._htOption)this._htDirty[b]=true;else this._htDirty[a]=true},getDirty:function(a){return a?this._htDirty[a]?true:false:this._htDirty},_resetDirty:function(){this._htDirty=null},addChild:function(a){collie.util.pushWithSort(this._aDisplayObjects,a);a.setParent(this);this._oLayer!==null&&a.setLayer(this._oLayer);this.setChanged()},removeChild:function(a,b){if(typeof b!==
"undefined"){this._aDisplayObjects[b].unsetLayer();this._aDisplayObjects[b].unsetParent();this._aDisplayObjects.splice(b,1)}else for(var c=0,d=this._aDisplayObjects.length;c<d;c++)if(this._aDisplayObjects[c]===a){this._aDisplayObjects[c].unsetLayer();this._aDisplayObjects[c].unsetParent();this._aDisplayObjects.splice(c,1);break}this.setChanged()},changeDisplayObjectZIndex:function(a){this.removeChild(a);this.addChild(a)},addTo:function(a){if(this._oLayer||this._oParent)if(this._oLayer===a||this._oParent===
a)return this;else this.leave();a.addChild(this);return this},hasChild:function(){return this._aDisplayObjects.length>0},getChildren:function(){return this._aDisplayObjects},getParent:function(){return this._oParent||false},setParent:function(a){this._oParent=a},unsetParent:function(){this._oParent=null},leave:function(){var a=null;if(this._oParent!==null)a=this._oParent;else if(this._oLayer)a=this.getLayer();a&&a.removeChild(this);return this},getId:function(){return this._sId},getImage:function(){return this._elImage||
null},getImageSize:function(){return this._htImageSize||false},setImage:function(a){if(typeof a==="string"||!a){if(this._htGetImageData!==null&&this._htGetImageData.name!==a){collie.ImageManager.cancelGetImage(this._htGetImageData.name,this._htGetImageData.callback);this._htGetImageData=null}if(a){this._htGetImageData={name:a,callback:function(b){this.setImage(b)}.bind(this)};collie.ImageManager.getImage(this._htGetImageData.name,this._htGetImageData.callback)}else{this._elImage=null;this.setChanged()}}else if(!(this._elImage&&
this._elImage===a)){this._elImage=a;this._nImageWidth=a.width;this._nImageHeight=a.height;this._htImageSize={width:this._bRetinaDisplay?this._nImageWidth/2:this._nImageWidth,height:this._bRetinaDisplay?this._nImageHeight/2:this._nImageHeight};this._htSpriteSheet=collie.ImageManager.getSprite(this._htOption.backgroundImage);this._bCustomSize||this.set({width:this._htImageSize.width,height:this._htImageSize.height});this._setSpritePosition("spriteSheet",this._htOption.spriteSheet);this._setSpritePosition("spriteX",
this._htOption.spriteX);this._setSpritePosition("spriteY",this._htOption.spriteY);this.setDirty("backgroundImage");this.setChanged()}},getDrawing:function(){return this._oDrawing},setChanged:function(a){if(!(this._bChanged||a&&this._bChangedTransforms)){this._oLayer!==null&&this._oLayer.setChanged();if(!a)this._bChanged=true;this._bChangedTransforms=true;this._oParent&&this._oParent.setChanged(false)}},unsetChanged:function(){this._bChangedTransforms=this._bChanged=false},isChanged:function(a){return!a?
this._bChanged||this._bChangedTransforms:!this._bChanged&&this._bChangedTransforms},setLayer:function(a){if(this._sId in collie.DisplayObject.htFactory)throw Error("Exists DisplayObject Id "+this._sId);collie.DisplayObject.htFactory[this._sId]=this;this._oLayer=a;this._sRenderingMode=this._oLayer.getRenderingMode();this._makeDrawing();this._oDrawing.load();this.setChanged();if(typeof this._htOption.x==="string"||typeof this._htOption.y==="string")this.align(typeof this._htOption.x==="string"?this._htOption.x:
false,typeof this._htOption.y==="string"?this._htOption.y:false);if(this._nPositionRight!==null){this.right(this._nPositionRight);this._nPositionRight=null}if(this._nPositionBottom!==null){this.bottom(this._nPositionBottom);this._nPositionBottom=null}for(var b=0,c=this._aDisplayObjects.length;b<c;b++)this._aDisplayObjects[b].setLayer(a)},unsetLayer:function(){if(this.getLayer()){for(var a=0,b=this._aDisplayObjects.length;a<b;a++)this._aDisplayObjects[a].unsetLayer();this._oDrawing.unload();this.setDirty();
this.setChanged();this._oLayer=this._oDrawing=this._sRenderingMode=null;delete collie.DisplayObject.htFactory[this._sId]}},_makeDrawing:function(){if(this._oDrawing===null)this._oDrawing=this._sRenderingMode==="dom"?new collie.DisplayObjectDOM(this):new collie.DisplayObjectCanvas(this)},getLayer:function(){return this._oLayer||false},addMatrix:function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.addMatrix(a[b]);else{this._htMatrix[a.name]=a;delete this._htMatrix[a.name].name}},changeMatrix:function(a){a in
this._htMatrix&&this.set(this._htMatrix[a])},update:function(a,b,c,d,e,f){this._updateMovableOption(a);if(this._sRenderingMode==="canvas"&&!this._htOption.visible)this.unsetChanged();else{b+=this._htOption.x;c+=this._htOption.y;if(this._sRenderingMode==="dom"&&this.isChanged()||this._sRenderingMode==="canvas"&&(b+this._htOption.width>=0||b<=d||c+this._htOption.height>=0||c<=e))this._oDrawing.draw(a,b,c,d,e,f);this.unsetChanged();this._resetDirty();if(this._htOption.velocityX!==0||this._htOption.velocityY!==
0||this._htOption.velocityRotate!==0||this._htOption.forceX!==0||this._htOption.forceY!==0||this._htOption.forceRotate!==0)this.setChanged(true);if(!(this._sRenderingMode==="canvas"||!this._htOption.visible))if(this.hasChild()){f=0;for(var g=this._aDisplayObjects.length;f<g;f++)this._aDisplayObjects[f].update(a,b,c,d,e)}}},_updateMovableOption:function(a){if(this._htOption.velocityX!==0||this._htOption.velocityY!==0||this._htOption.velocityRotate!==0||this._htOption.forceX!==0||this._htOption.forceY!==
0||this._htOption.forceRotate!==0){a=Math.max(17,a)/1E3;this._htOption.useRealTime||(a=1);var b=this._htOption.velocityX,c=this._htOption.velocityY,d=this._htOption.x,e=this._htOption.y;b+=this._htOption.forceX/this._htOption.mass*a;c+=this._htOption.forceY/this._htOption.mass*a;var f=this._htOption.friction*b*this._htOption.mass*a,g=this._htOption.friction*c*this._htOption.mass*a;if(b!==0)b=Math.abs(b)/b!==Math.abs(b-f)/(b-f)?0:b-f;if(c!==0)c=Math.abs(c)/c!==Math.abs(c-g)/(c-g)?0:c-g;d+=b*a;e+=c*
a;b=Math.floor(b*1E3)/1E3;c=Math.floor(c*1E3)/1E3;if(this._htOption.friction&&Math.abs(b)<0.05)b=0;if(this._htOption.friction&&Math.abs(c)<0.05)c=0;if(d!==this._htOption.x||e!==this._htOption.y||b!==this._htOption.velocityX||c!==this._htOption.velocityY){this.set("x",d);this.set("y",e);this.set("velocityX",b);this.set("velocityY",c)}this._htOption.forceRotate!==0&&this.set("velocityRotate",this._htOption.velocityRotate+this._htOption.forceRotate);if(this._htOption.velocityRotate!==0){a=collie.util.fixAngle(collie.util.toRad(this._htOption.angle+
this._htOption.velocityRotate*a));this.set("angle",Math.round(collie.util.toDeg(a)*1E3)/1E3)}}},getRelatedPosition:function(){if(this._htRelatedPosition.x===null){this._htRelatedPosition.x=this._htOption.x;this._htRelatedPosition.y=this._htOption.y;if(this._oParent){var a=this._oParent.getRelatedPosition();this._htRelatedPosition.x+=a.x;this._htRelatedPosition.y+=a.y}}return this._htRelatedPosition},getBoundary:function(a,b){var c=collie.Transform.getBoundary(this,b);this._htBoundary.left=c.left;
this._htBoundary.right=c.right;this._htBoundary.top=c.top;this._htBoundary.bottom=c.bottom;this._htBoundary.isTransform=c.isTransform;this._htBoundary.points=c.points;if(a){c=this.getRelatedPosition();if(this._htBoundary.points)for(var d=0,e=this._htBoundary.points.length;d<e;d++){this._htBoundary.points[d][0]+=c.x;this._htBoundary.points[d][1]+=c.y}this._htBoundary.left+=c.x;this._htBoundary.right+=c.x;this._htBoundary.top+=c.y;this._htBoundary.bottom+=c.y}return this._htBoundary},resetPositionCache:function(){this._htRelatedPosition.x=
null;this._htRelatedPosition.y=null;if(this.hasChild())for(var a=0,b=this._aDisplayObjects.length;a<b;a++)this._aDisplayObjects[a].resetPositionCache()},getHitAreaBoundary:function(){if(this._htOption.hitArea)if(this._htOption.hitArea instanceof Array){var a=collie.Transform.points(this,collie.util.getBoundaryToPoints(this._htHitAreaBoundary));a=collie.util.getBoundary(a);var b=this.getRelatedPosition();return{left:a.left+b.x,right:a.right+b.x,top:a.top+b.y,bottom:a.bottom+b.y}}else return this._htOption.hitArea.getBoundary(true);
else return this.getBoundary(true)},getOrigin:function(){return this._htOrigin},_setOrigin:function(){switch(this._htOption.originX){case "left":this._htOrigin.x=0;break;case "right":this._htOrigin.x=this._htOption.width;break;case "center":this._htOrigin.x=this._htOption.width/2;break;default:this._htOrigin.x=parseInt(this._htOption.originX,10)}switch(this._htOption.originY){case "top":this._htOrigin.y=0;break;case "bottom":this._htOrigin.y=this._htOption.height;break;case "center":this._htOrigin.y=
this._htOption.height/2;break;default:this._htOrigin.y=parseInt(this._htOption.originY,10)}},_fixPosition:function(){var a=this._htOption.x,b=this._htOption.y,c,d;if(this._htOption.rangeX){c=this._htOption.rangeX[0];d=this._htOption.rangeX[1];if(this._htOption.positionRepeat)if(a<c){do a+=d-c;while(a<c)}else{if(a>d){do a-=d-c;while(a>d)}}else{a=Math.max(c,a);a=Math.min(d,a)}a!==this._htOption.x&&this.set("x",a,true)}if(this._htOption.rangeY){a=this._htOption.rangeY[0];c=this._htOption.rangeY[1];if(this._htOption.positionRepeat)if(b<
a){do b+=c-a;while(b<a)}else{if(b>c){do b-=c-a;while(b>c)}}else{b=Math.max(a,b);b=Math.min(c,b)}b!==this._htOption.y&&this.set("y",b,true)}},_makeHitAreaBoundary:function(){this._htHitAreaBoundary=collie.util.getBoundary(this._htOption.hitArea)},align:function(a,b,c){if(this.getLayer()){c=c||this.getParent();var d=0,e=0;if(c){d=c._htOption.width;e=c._htOption.height}else{d=this._oLayer._htOption.width;e=this._oLayer._htOption.height}if(a!==false){d=a==="right"?d-this._htOption.width:d/2-this._htOption.width/
2;this.set("x",d)}if(b!==false){e=b==="bottom"?e-this._htOption.height:e/2-this._htOption.height/2;this.set("y",e)}}},right:function(a){var b=0;if(this._oParent)b=this._oParent._htOption.width;if(!b&&this._oLayer)b=this._oLayer._htOption.width;if(b)this.set("x",b-(this._htOption.width+a));else this._nPositionRight=a;return this},bottom:function(a){var b=0;if(this._oParent)b=this._oParent.get("height");if(!b&&this._oLayer)b=this._oLayer.option("height");if(b)this.set("y",b-(this._htOption.height+a));
else this._nPositionBottom=a;return this},resizeFixedRatio:function(a,b){if(this.getImage()){var c=this.getImage().width,d=this.getImage().height;if(a)b=a*(d/c);else if(b)a=b*(c/d);this.set("width",Math.round(a));this.set("height",Math.round(b))}},_setSpritePosition:function(a,b){if(this._elImage&&b!==null)if(this._htOption.spriteSheet!==null){var c=this._htSpriteSheet[this._htOption.spriteSheet],d;if(a==="spriteSheet"&&this._htSpriteSheet&&this._htSpriteSheet[b]){if(typeof c[0][0]!=="undefined")if(this._htOption.spriteX!==
null){d=c[this._htOption.spriteX][0];c=c[this._htOption.spriteX][1]}else{d=c[0][0];c=c[0][1]}else{d=c[0];c=c[1]}this.set("offsetX",d,true);this.set("offsetY",c,true)}else if(a==="spriteX"&&typeof c[b]!=="undefined"){this.set("offsetX",c[b][0],true);this.set("offsetY",c[b][1],true)}}else{d=this.getImageSize();var e=this._htOption.width,f=this._htOption.height,g=this._htOption.spriteLength-1,j=d.width/this._htOption.width-1,k=d.height/this._htOption.height-1;switch(a){case "spriteX":if(g>j&&f<d.height){c=
Math.floor(b/(j+1))*f;d=b%(j+1)*e}else d=Math.min(b,j)*e;this.set("offsetX",d,true);c!=null&&this.set("offsetY",c,true);break;case "spriteY":b=Math.min(b,k);this.set("offsetY",b*f,true)}}},hasAttachedHandler:function(){return this._htHandler&&"click"in this._htHandler&&this._htHandler.click.length>0||"mousedown"in this._htHandler&&this._htHandler.mousedown.length>0||"mouseup"in this._htHandler&&this._htHandler.mouseup.length>0?true:false},move:function(a,b,c,d){var e=this._htOption.x,f=this._htOption.y,
g=collie.util.getDistance(e,f,a,b);g=Math.round(g/c*1E3);if(this._oTimerMove!==null){this._oTimerMove.stop();this._oTimerMove=null}if(!c||g<collie.Renderer.getInfo().fps){this.set({x:a,y:b});d&&d(this)}else{a={from:[e,f],to:[a,b],set:["x","y"]};if(d)a.onComplete=function(){d(this)};return this._oTimerMove=collie.Timer.transition(this,g,a)}},moveBy:function(a,b,c,d){return this.move(this._htOption.x+a,this._htOption.y+b,c,d)},toString:function(){return"DisplayObject"+(this._htOption.name?" "+this._htOption.name:
"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")},clone:function(a){var b=new this.constructor(this._htOption);if(a&&this._aDisplayObjects.length){a=0;for(var c=this._aDisplayObjects.length;a<c;a++)this._aDisplayObjects[a].clone(true).addTo(b)}return b}},collie.Component);collie.DisplayObject._idx=0;collie.DisplayObject.htFactory={};collie.MovableObject=collie.Class({$init:function(){}},collie.DisplayObject);
collie.Rectangle=collie.Class({$init:function(){this.option({radius:0,strokeColor:"",strokeWidth:0,fillColor:"",fillImage:""},null,true);this._sBorderRadius=collie.util.getCSSPrefix("border-radius",true)},onDOMDraw:function(a){if(this._bChanged){if(this._htOption.radius){a.element.style[this._sBorderRadius]=this._htOption.radius+"px";a.element.style.borderRadius=this._htOption.radius+"px"}if(this._htOption.fillImage)collie.ImageManager.getImage(this._htOption.fillImage,function(b){a.element.style.backgroundImage=
"url('"+b.src+"')"});else if(this._htOption.fillColor)a.element.style.backgroundColor=this._htOption.fillColor;if(this._htOption.strokeWidth)a.element.style.border=this._htOption.strokeWidth+"px solid "+this._htOption.strokeColor;this._bChanged=false}},onCanvasDraw:function(a){var b=this.get(),c=a.context,d=this._htOption.radius,e=this._htOption.width,f=this._htOption.height,g=this._htOption.strokeWidth;if(collie.Renderer.isRetinaDisplay()){e*=2;f*=2;d*=2;g*=2}if(b.fillImage){var j=collie.ImageManager.getImage(b.fillImage);
if(j){b=c.createPattern(j,"repeat");c.fillStyle=b}else collie.ImageManager.getImage(b.fillImage,function(){this.setChanged()}.bind(this))}else if(b.fillColor)c.fillStyle=b.fillColor;if(this._htOption.strokeColor)c.strokeStyle=this._htOption.strokeColor;if(this._htOption.strokeWidth)c.lineWidth=g;if(d){c.save();c.translate(a.x,a.y);c.beginPath();c.moveTo(d,0);c.lineTo(e-d,0);c.quadraticCurveTo(e,0,e,d);c.lineTo(e,f-d);c.quadraticCurveTo(e,f,e-d,f);c.lineTo(d,f);c.quadraticCurveTo(0,f,0,f-d);c.lineTo(0,
d);c.quadraticCurveTo(0,0,d,0);c.closePath();c.restore();if(this._htOption.fillColor||this._htOption.fillImage)c.fill();this._htOption.strokeWidth&&c.stroke()}else{if(this._htOption.fillColor||this._htOption.fillImage)c.fillRect(a.x,a.y,e,f);this._htOption.strokeWidth&&c.strokeRect(a.x,a.y,e,f)}this._bChanged=false},toString:function(){return"Rectangle"+(this.get("name")?" "+this.get("name"):"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject);
collie.Circle=collie.Class({$init:function(){this.option({radius:0,strokeColor:"#000000",strokeWidth:0,fillColor:"",fillImage:"",startAngle:0,endAngle:360,closePath:false,anticlockwise:false,autoExpand:true},null,true);this._oPaper=null;this.optionSetter("radius",this._expandSize.bind(this));this._expandSize()},_expandSize:function(){if(this._htOption.autoExpand&&this._htOption.radius){var a=this._htOption.radius*2+this._htOption.strokeWidth;this.set("width",a);this.set("height",a)}},onDOMDraw:function(a){var b=
a.element;if(typeof Raphael!=="undefined"){a=this.get();var c=a.strokeWidth,d=a.radius,e=a.width,f=a.height,g=this.getDirty(),j;if(this._oPaper===null){this._oPaper=Raphael(b,e+c,f+c);this._oPaper.canvas.style.zIndex=10}else if(g&&(g.width||g.height))this._oPaper.setSize(e,f);b.style.left=-(c/2)+"px";b.style.top=-(c/2)+"px";this._oPaper.clear();if(d){b=d+d*Math.cos(collie.util.toRad(a.startAngle));e=d+d*Math.sin(collie.util.toRad(a.startAngle));f=d+d*Math.cos(collie.util.toRad(a.endAngle));g=d+d*
Math.sin(collie.util.toRad(a.endAngle));var k=a.anticlockwise?a.startAngle-a.endAngle:a.endAngle-a.startAngle;if(Math.abs(k)>=360)k=360;else if(k<0)k+=360;var h=k>180?1:0,m=a.anticlockwise?0:1;j=k>=360?this._oPaper.circle(d,d,d):this._oPaper.path("M"+b+","+e+"a"+d+","+d+",0,"+h+","+m+","+(f-b)+","+(g-e)+(a.closePath?"L"+d+","+d+"L"+b+","+e+"Z":""))}if(j){j.transform("t"+c/2+","+c/2);if(a.fillImage)collie.ImageManager.getImage(a.fillImage,function(l){j.attr("fill","url('"+l.src+"')")});else a.fillColor&&
j.attr("fill",a.fillColor);a.strokeColor&&j.attr("stroke",a.strokeColor);j.attr("stroke-width",a.strokeWidth)}}},onCanvasDraw:function(a){var b=this.get(),c=a.context,d=a.x,e=a.y,f=collie.Renderer.isRetinaDisplay();a=b.radius;var g=b.strokeWidth,j=b.width,k=b.height;if(f){j*=2;k*=2;a*=2;g*=2}if(b.fillImage)if(f=collie.ImageManager.getImage(b.fillImage)){f=c.createPattern(f,"repeat");c.fillStyle=f}else collie.ImageManager.getImage(b.fillImage,function(){this.setChanged()}.bind(this));else if(b.fillColor)c.fillStyle=
b.fillColor;if(b.strokeColor)c.strokeStyle=b.strokeColor;if(g)c.lineWidth=g;if(a){d+=a;e+=a;g=Math.abs(b.startAngle-b.endAngle)>=360;c.beginPath();b.closePath&&!g&&c.moveTo(d,e);c.arc(d,e,a,collie.util.toRad(b.startAngle),collie.util.toRad(b.endAngle),b.anticlockwise);b.closePath&&c.closePath();if(b.fillColor||b.fillImage)c.fill();b.strokeWidth&&c.stroke()}},center:function(a,b){this.set("x",a-this._htOption.radius);this.set("y",b-this._htOption.radius);return this},toString:function(){return"Circle"+
(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject);
collie.Polyline=collie.Class({$init:function(){this.option({strokeColor:"#000000",strokeWidth:1,fillColor:"",fillImage:"",lineCap:"butt",lineJoin:"miter",miterLimit:10,dashArray:"",closePath:false},null,true);this._aPointData=[];this._oPaper=null;this._htPointBoundary={right:null,bottom:null}},setPointData:function(a,b){this._aPointData=a;this.setChanged();b||this._expandBoundary(a)},getPointData:function(){return this._aPointData},addPoint:function(a,b,c){this._aPointData.push([a,b]);this.setChanged();
c||this._expandBoundary(a,b)},moveTo:function(a,b){this._aPointData.push([a,b,true])},lineTo:function(a,b,c){this.addPoint(a,b,c)},resetPointData:function(){this._aPointData=[];this._htPointBoundary={right:null,bottom:null};this.setChanged()},_expandBoundary:function(a,b,c){if(a instanceof Array){b=0;for(var d=a.length;b<d;b++)this._expandBoundary(a[b][0],a[b][1],true)}else{this._htPointBoundary.right=this._htPointBoundary.right===null?a:Math.max(a,this._htPointBoundary.right);this._htPointBoundary.bottom=
this._htPointBoundary.bottom===null?b:Math.max(b,this._htPointBoundary.bottom)}if(!c){c=this._htOption.strokeWidth*(collie.Renderer.isRetinaDisplay()?2:1);a=this._htPointBoundary.right+c*2;c=this._htPointBoundary.bottom+c*2;this.set({width:a,height:c});this._oPaper!==null&&this._oPaper.setSize(a,c)}},onDOMDraw:function(a){var b=a.element;if(!(this._aPointData.length<2))if(typeof Raphael!=="undefined"){a=this.get();var c=a.strokeWidth,d=this.getDirty();if(this._oPaper===null){this._oPaper=Raphael(b,
a.width,a.height);this._oPaper.canvas.style.zIndex=10}else if(d&&(d.width||d.height))this._oPaper.setSize(a.width,a.height);b.style.left=-(c/2)+"px";b.style.top=-(c/2)+"px";this._oPaper.clear();b="M"+this._aPointData[0][0]+","+this._aPointData[0][1];d=1;for(var e=this._aPointData.length;d<e;d++)b+=(this._aPointData[d][2]?"M":"L")+this._aPointData[d][0]+","+this._aPointData[d][1];if(a.closePath&&(this._aPointData[0][0]!==this._aPointData[this._aPointData.length-1][0]||this._aPointData[0][1]!==this._aPointData[this._aPointData.length-
1][1]))b+="L"+this._aPointData[0][0]+","+this._aPointData[0][1];var f=this._oPaper.path(b+(a.closePath?"Z":""));f.transform("t"+c/2+","+c/2);if(a.fillImage)collie.ImageManager.getImage(a.fillImage,function(g){f.attr("fill","url('"+g.src+"')")});else a.fillColor&&f.attr("fill",a.fillColor);a.lineCap&&f.attr("stroke-linecap",a.lineCap);a.lineJoin&&f.attr("stroke-linejoin",a.lineJoin);a.miterLimit!==null&&f.attr("stroke-miterlimit",a.miterLimit);a.strokeColor&&f.attr("stroke",a.strokeColor);f.attr("stroke-width",
c);a.dashArray&&f.attr("stroke-dasharray",a.dashArray)}},onCanvasDraw:function(a){if(!(this._aPointData.length<2)){var b=this.get(),c=a.context,d=collie.Renderer.isRetinaDisplay(),e=b.strokeWidth,f=d?2:1;c.save();c.translate(a.x,a.y);if(d)e*=2;if(b.fillImage)if(a=collie.ImageManager.getImage(b.fillImage)){a=c.createPattern(a,"repeat");c.fillStyle=a}else collie.ImageManager.getImage(b.fillImage,function(){this.setChanged()}.bind(this));else if(b.fillColor)c.fillStyle=b.fillColor;if(b.strokeColor)c.strokeStyle=
b.strokeColor;c.lineWidth=e;if(b.lineCap)c.lineCap=b.lineCap;if(b.lineJoin)c.lineJoin=b.lineJoin;if(b.miterLimit)c.miterLimit=b.miterLimit;if(b.dashArray){if(b.fillColor||b.fillImage){c.beginPath();c.moveTo(this._aPointData[0][0]*f,this._aPointData[0][1]*f);a=1;for(d=this._aPointData.length;a<d;a++)this._aPointData[a][2]?c.moveTo(this._aPointData[a][0]*f,this._aPointData[a][1]*f):c.lineTo(this._aPointData[a][0]*f,this._aPointData[a][1]*f);b.closePath&&c.closePath();c.fill()}c.resetDashedLine()}c.beginPath();
c.moveTo(this._aPointData[0][0]*f,this._aPointData[0][1]*f);a=1;for(d=this._aPointData.length;a<d;a++)if(this._aPointData[a][2])c.moveTo(this._aPointData[a][0]*f,this._aPointData[a][1]*f);else b.dashArray?c.dashedLine(this._aPointData[a-1][0]*f,this._aPointData[a-1][1]*f,this._aPointData[a][0]*f,this._aPointData[a][1]*f,collie.raphaelDashArray[b.dashArray],e):c.lineTo(this._aPointData[a][0]*f,this._aPointData[a][1]*f);if(b.dashArray&&b.closePath&&(this._aPointData[0][0]!==this._aPointData[this._aPointData.length-
1][0]||this._aPointData[0][1]!==this._aPointData[this._aPointData.length-1][1]))c.dashedLine(this._aPointData[a-1][0]*f,this._aPointData[a-1][1]*f,this._aPointData[0][0]*f,this._aPointData[0][1]*f,collie.raphaelDashArray[b.dashArray],e);b.closePath&&c.closePath();if(!b.dashArray&&(b.fillColor||b.fillImage))c.fill();b.strokeWidth&&c.stroke();c.restore()}},toString:function(){return"Polyline"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+
")":"")}},collie.DisplayObject);
collie.Text=collie.Class({$init:function(){this._sText="";this.option({fontFamily:"Arial",fontWeight:"",fontSize:12,fontColor:"#000000",lineHeight:"auto",textAlign:"left",padding:"0 0 0 0",ellipsisMaxLine:0,ellipsisString:"...",useEllipsis:false,useCache:true},null,true);this._elText=null;this._nTextWidth=0;this._nRatio=1;this._aCallbackTextWidth=[]},_initElement:function(){if(this._elText===null){this._elText=document.createElement("div");this._elText.style.display="inline";this.getDrawing().getItemElement().appendChild(this._elText)}},
onCanvasDraw:function(a){this._nRatio=this._sRenderingMode==="canvas"&&this._bRetinaDisplay?2:1;this._oContext=a.context;var b=this._getMaxWidth();this._oContext.font=this._getFontText();this._oContext.fillStyle=this._htOption.fontColor;this._oContext.textBaseline="top";this._fillTextMultiline(this._wordWrap(b).split("\n"),a.x,a.y);this._triggerGetTextWidth()},onDOMDraw:function(a){this._initElement();this.getDrawing();var b=a.element;a=this._sText.replace(/\n/g,"<br ></d>");b=b.style;b.font=this._getFontText();
b.color=this._htOption.fontColor;b.padding=this._getPadding().replace(/ /g,"px ")+"px";b.width=this._getMaxWidth()+"px";b.height=this._getMaxHeight()+"px";b.lineHeight=this._getLineHeight()+"px";b.textAlign=this._htOption.textAlign;if(this._elText.innerHTML!=a)this._elText.innerHTML=a;this.unsetChanged();this._getDOMTextWidth();this._triggerGetTextWidth()},_getDOMTextWidth:function(){if(this._elText!==null)this._nTextWidth=this._elText.offsetWidth},_getFontText:function(){return this._htOption.fontWeight+
" "+this._htOption.fontSize*this._nRatio+"px "+this._htOption.fontFamily},_getLineHeight:function(){return this._htOption.lineHeight==="auto"?this._htOption.fontSize*this._nRatio:this._htOption.lineHeight*this._nRatio},_fillTextMultiline:function(a,b,c){for(var d=this._getPadding("left"),e=this._htOption.ellipsisMaxLine,f=this._nTextWidth=0;f<a.length;f++){if(e&&f>=e-1)if(a.length>e){a[f]=this._insertEllipsisText(a[f]);a.splice(f+1,a.length-(f+1))}var g=this._oContext.measureText(a[f]).width;if(this._htOption.textAlign===
"center")d=this._getMaxWidth()/2-g/2+this._getPadding("left");else if(this._htOption.textAlign==="right")d=this._htOption.width*this._nRatio-this._getPadding("right")-g;this._oContext.fillText(a[f],b+d,c+this._getTopPosition(f+1));this._nTextWidth=Math.max(this._nTextWidth,g)}},_getMaxWidth:function(){return this._htOption.width*this._nRatio-(this._getPadding("left")+this._getPadding("right"))},_getMaxHeight:function(){return this._htOption.height*this._nRatio-(this._getPadding("top")+this._getPadding("bottom"))},
_getTopPosition:function(a){return this._getLineHeight()*(a-1)+this._getPadding("top")},_getPadding:function(a){for(var b=(this._htOption.padding||"0 0 0 0").split(" "),c=0,d=b.length;c<d;c++)b[c]=parseInt(b[c],10)*this._nRatio;switch(a){case "top":return b[0];case "right":return b[1];case "bottom":return b[2];case "left":return b[3];default:return b.join(" ")}},_insertEllipsisText:function(a){for(var b=this._getMaxWidth(),c="",d=a.length;d>0;d--){c=a.substr(0,d)+this._htOption.ellipsisString;if(this._oContext.measureText(c).width<=
b)return c}return a},_wordWrap:function(a,b){var c=b||this._sText,d=1;if(!c)return"";for(b=c.substr(0,1);this._oContext.measureText(b).width<=a;){d++;if(d>c.length)return b;b=c.substr(0,d);if(c.substr(d-1,1)==="\n")break}d=Math.max(1,d-1);b=c.substr(0,d);c.substr(d,1)==="\n"&&d++;if(c.length>d)b+="\n"+this._wordWrap(a,c.substr(d));return b},text:function(a){this._nTextWidth=0;this._aCallbackTextWidth=[];this._sText=a.toString();this.setChanged();return this},getTextWidth:function(a){a&&this._aCallbackTextWidth.push(a);
if(this._nTextWidth){this._triggerGetTextWidth();return this._nTextWidth/this._nRatio}},_triggerGetTextWidth:function(){if(this._aCallbackTextWidth.length>0){for(var a=0,b=this._aCallbackTextWidth.length;a<b;a++)this._aCallbackTextWidth[a](this._nTextWidth/this._nRatio);this._aCallbackTextWidth=[]}},toString:function(){return"Text"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject);
collie.Animation=collie.Class({$init:function(a,b,c){this._nId=++collie.Animation._idx;this._bIsPlaying=false;this._fCallback=a;this._oTimerList=null;this.option("useAutoStart",true);this.option((typeof b==="object"?b:c)||{});this.setDuration(b);this.setOptionEvent(c)},setOptionEvent:function(a){if(a)for(var b in a)b.toString().indexOf("on")===0&&this.attach(b.toString().replace(/^on/,"").toLowerCase(),a[b])},triggerCallback:function(a){if(typeof this._fCallback!=="function"&&this._htOption.set){var b=
{};if(this._htOption.set instanceof Array)for(var c=0,d=this._htOption.set.length;c<d;c++)b[this._htOption.set[c]]=a.value instanceof Array?a.value[c]:a.value;else b[this._htOption.set]=a.value;if(this._fCallback instanceof Array){a=0;for(d=this._fCallback.length;a<d;a++)this._fCallback[a].set(b)}else this._fCallback.set(b)}else this._fCallback&&this._fCallback(a)},setDuration:function(a){this._nDuration=parseInt(a,10)},getDuration:function(){return this._nDuration},setTimerList:function(a){this._oTimerList=
a;this._htOption.useAutoStart&&this.start()},getId:function(){return this._nId},run:function(){throw Error("abstract method");},reset:function(){throw Error("abstract method");},stop:function(a){if(this.isPlaying()){this._oTimerList!==null&&this._oTimerList.remove(this);this._bIsPlaying=false;this.reset();a||this.fireEvent("stop")}},pause:function(){if(this.isPlaying()){this._bIsPlaying=false;this.fireEvent("pause");this._oTimerList!==null&&this._oTimerList.remove(this)}},start:function(){if(!this.isPlaying()){this._bIsPlaying=
true;this._oTimerList!==null&&this._oTimerList.add(this);this.fireEvent("start")}},isPlaying:function(){return this._bIsPlaying},complete:function(){if(this.isPlaying()){this._fCallbackComplete&&this._fCallbackComplete();this.stop(true);this.fireEvent("complete")}}},collie.Component);collie.Animation._idx=0;
collie.AnimationTransition=collie.Class({$init:function(a,b,c){this.option({from:null,to:null,set:"",loop:1,effect:collie.Effect.linear});this._htCallback={};this.option(c||{});a=this.reset.bind(this);this.optionSetter("from",a);this.optionSetter("to",a);this._nCountCycle=this._nCount=0;this._nRunningTime=this._nFrameAtRunLastest=null;this._bIsArrayValue=false},start:function(){this._htOption.from===null&&typeof this._fCallback!=="function"&&this._setDefaultFromValues();this._nFrameAtRunLastest===
null&&this.reset();this.constructor.$super.start.call(this)},_setDefaultFromValues:function(){var a=null;if(this._htOption.set){if(this._htOption.set instanceof Array){a=[];for(var b=0,c=this._htOption.set.length;b<c;b++)a.push(this._fCallback.get(this._htOption.set[b]))}else a=this._fCallback.get(this._htOption.set);this.option("from",a)}},reset:function(){this._nRunningTime=this._nFrameAtRunLastest=null;this._nValue=this._htOption.from;this._bIsArrayValue=this._htOption.from instanceof Array;this._nCountCycle=
this._nCount=0;if(this._bIsArrayValue){this._fEffect=[];for(var a=null,b=0,c=this._htOption.from.length;b<c;b++){a=this._htOption.effect instanceof Array?this._htOption.effect[b]:this._htOption.effect;this._fEffect[b]=a(this._htOption.from[b],this._htOption.to[b])}}else this._fEffect=this._htOption.effect(this._htOption.from,this._htOption.to)},setValue:function(a){this._nValue=a},getValue:function(){return this._nValue},run:function(a,b){if(a===undefined)a=collie.Renderer.getInfo().frame;if(this._nFrameAtRunLastest>
a)this.reset();else{if(this._nFrameAtRunLastest===null){this._nFrameAtRunLastest=a;b=this._nRunningTime=0}this._nRunningTime+=b;this._nCount++;if(this._nRunningTime>=this._nDuration){this._nCountCycle++;if(!this._isEndValue()&&this._htOption.loop&&this._htOption.loop<=this._nCountCycle)this._setEndValue();else if(!this._htOption.loop||this._htOption.loop>this._nCountCycle){this.fireEvent("end");this._nFrameAtRunLastest=a;this._nRunningTime-=this._nDuration;this._nValue=this._htOption.from;this._transitionValue(this._nRunningTime)}else{this.complete();
return}}else this._nRunningTime>0&&this._transitionValue(this._nRunningTime);this._htCallback.timer=this;this._htCallback.frame=a;this._htCallback.duration=this._nDuration;this._htCallback.cycle=this._nCountCycle;this._htCallback.runningTime=this._nRunningTime;this._htCallback.from=this._htOption.from;this._htCallback.to=this._htOption.to;this._htCallback.value=this._nValue;this.triggerCallback(this._htCallback);if(this._nRunningTime>0)this._nFrameAtRunLastest=a}},_transitionValue:function(a){if(this._bIsArrayValue){this._nValue=
[];for(var b=0,c=this._htOption.from.length;b<c;b++)this._nValue[b]=parseFloat(this._fEffect[b](Math.max(0,Math.min(1,a/this._nDuration))))}else this._nValue=parseFloat(this._fEffect(Math.max(0,Math.min(1,a/this._nDuration))))},_isEndValue:function(){if(this._bIsArrayValue){for(var a=0,b=this._htOption.to.length;a<b;a++)if(this._nValue[a]!==parseFloat(this._fEffect[a](1)))return false;return true}else return this._nValue===parseFloat(this._fEffect(1))},_setEndValue:function(){if(this._bIsArrayValue)for(var a=
0,b=this._htOption.to.length;a<b;a++)this._nValue[a]=parseFloat(this._fEffect[a](1));else this._nValue=parseFloat(this._fEffect(1))}},collie.Animation);
collie.AnimationRepeat=collie.Class({$init:function(a,b,c){this.option({beforeDelay:0,afterDelay:0,loop:0,useRealTime:true});this.option(c||{});this.reset();this.setDuration(b);this._nFrameAtRunLastest=null},setDuration:function(a){a=parseInt(a,10);if(a<collie.Renderer.getDuration())a=collie.Renderer.getDuration();this._nDuration=a},reset:function(){this._nCount=0;this._nRunLastestTime=this._nRunningTime=this._nFrameAtRunLastest=null;this._nBeforeDelay=this._htOption.beforeDelay},run:function(a,b){if(a===
undefined)a=collie.Renderer.getInfo().frame;if(this._nFrameAtRunLastest>a)this.reset();else{if(this._nFrameAtRunLastest===null){this._nFrameAtRunLastest=a;b=this._nRunLastestTime=this._nRunningTime=0}this._nRunningTime+=b;var c=Math.max(1,Math.floor((this._nRunningTime-this._nRunLastestTime)/this._nDuration))-1;if(this._nCount===0&&this._nBeforeDelay){if(this._nRunLastestTime+this._nBeforeDelay<=this._nRunningTime){this.reset();this._nBeforeDelay=0}}else if(this._nRunningTime===0||this._nRunLastestTime+
this._nDuration<=this._nRunningTime){this._nCount+=this._htOption.useRealTime?1+c:1;this._fCallback({timer:this,frame:a,duration:this._nDuration,count:this._nCount,skippedCount:c,runningTime:this._nRunningTime});if(this._htOption.loop&&this._htOption.loop<=this._nCount)this.complete();else{this._nFrameAtRunLastest=a;this._nRunLastestTime=this._nRunningTime}}}}},collie.Animation);
collie.AnimationCycle=collie.Class({$init:function(a,b,c){this._nFPS=null;this._htCallback={};a=this._setterFPS.bind(this);this.optionSetter("valueSet",this._setterValueSet.bind(this));this.optionSetter("to",a);this.optionSetter("from",a);this.option({delay:0,from:0,to:0,step:1,loop:0,set:"spriteX",useRealTime:true,valueSet:null,start:null});this.option(c||{});this._nRunningTime=this._nRunLastestTime=this._nFrameAtRunLastest=null;this._nCountCycleBefore=this._nCountCycle=0;this.setDuration(b);this.reset()},
reset:function(){this._nCountCycleBefore=this._nCountCycle=this._nCount=0;this._nRunLastestTime=this._nRunningTime=this._nFrameAtRunLastest=null;this._nValue=(this._htOption.start!==null?this._htOption.start:this._htOption.from)-this._htOption.step},_setterValueSet:function(){var a=this._htOption.valueSet;a&&a instanceof Array&&this.option({from:0,to:a.length-1,step:1})},_setterFPS:function(){if(this._nFPS!==null&&typeof this._htOption.to!=="undefined"&&typeof this._htOption.from!=="undefined")this._nDuration=
Math.round(1E3/this._nFPS*(this._htOption.to-this._htOption.from+1))},setDuration:function(a){this._nDuration=parseInt(a,10);if(/fps/i.test(a)&&typeof this._htOption.to!=="undefined"&&typeof this._htOption.from!=="undefined"){this._nFPS=parseInt(a,10);this._setterFPS()}else this._nFPS=null},setValue:function(a){this._nValue=a},getValue:function(){return this._htOption.valueSet?this._htOption.valueSet[this._nValue]:this._nValue},run:function(a,b){if(typeof a==="undefined")a=collie.Renderer.getInfo().frame;
if(this._nFrameAtRunLastest>a)this.reset();else{if(this._nFrameAtRunLastest===null){this._nFrameAtRunLastest=a;b=this._nRunningTime=this._nRunLastestTime=0}b||(b=0);var c=this._htOption;this._nTotalCount=(c.to-c.from)/c.step;this._nTerm=this._nDuration/this._nTotalCount;this._nRunningTime+=b;var d=!c.useRealTime?0:Math.max(1,Math.floor((this._nRunningTime-this._nRunLastestTime)/this._nTerm))-1;if(this._nRunningTime===0||this._nRunLastestTime+this._nTerm<=this._nRunningTime){this._nCountCycleBefore!==
this._nCountCycle&&this.fireEvent("end");if(c.loop&&this._nCountCycle>=c.loop)this.complete();else{if(this._nValue===c.to)this._nValue=c.from-c.step;this._nValue+=c.step*(1+d);this._nCount+=1+d;this._nCountCycleBefore=this._nCountCycle;if(c.from<=c.to?this._nValue>=c.to:this._nValue<=c.to){var e=(this._nValue-c.to)/c.step,f=Math.ceil(e/(this._nTotalCount+1));e%=this._nTotalCount+1;if(e){this._nCountCycle+=f;this._nValue=c.from+(e-1)*c.step}else{this._nCountCycle+=1;this._nValue=c.to}}this._htCallback.timer=
this;this._htCallback.frame=a;this._htCallback.duration=this._nDuration;this._htCallback.count=this._nCount;this._htCallback.skippedCount=d;this._htCallback.runningTime=this._nRunningTime;this._htCallback.value=this.getValue();this._htCallback.cycle=this._nCountCycle;this._htCallback.step=c.step;this._htCallback.from=c.from;this._htCallback.to=c.to;this.triggerCallback(this._htCallback);this._nFrameAtRunLastest=a;this._nRunLastestTime=this._nRunningTime}}}}},collie.Animation);
collie.AnimationDelay=collie.Class({$init:function(){this.reset()},reset:function(){this._nRunLastestTime=this._nRunningTime=this._nFrameAtRunLastest=null},run:function(a,b){if(a===undefined)a=collie.Renderer.getInfo().frame;if(this._nFrameAtRunLastest>a)this.reset();else{if(this._nFrameAtRunLastest===null){this._nFrameAtRunLastest=a;b=this._nRunningTime=this._nRunLastestTime=0}this._nRunningTime+=b;if(this._nRunLastestTime+this._nDuration<=this._nRunningTime){this._fCallback&&this._fCallback({timer:this,
frame:a,duration:this._nDuration,runningTime:this._nRunningTime});this.complete()}}}},collie.Animation);
collie.AnimationTimeline=collie.Class({$init:function(a,b){this.option("loop",1);this.option(b||{});this.setOptionEvent(b);this._htAnimations={};this._nRunningTime=this._aRunningAnimation=this._aTimeline=null;this._nCountCycle=0;if(a)for(var c=0,d=a.length;c<d;c++)this.addTimeline.apply(this,a[c]);this.reset()},add:function(a,b,c,d,e){switch(b){case "delay":b=new collie.AnimationDelay(c,d,e);break;case "repeat":b=new collie.AnimationRepeat(c,d,e);break;case "transition":b=new collie.AnimationTransition(c,
d,e);break;case "cycle":b=new collie.AnimationCycle(c,d,e);break;case "queue":b=new collie.AnimationQueue(c);break;default:if(!(b instanceof collie.Animation))throw Error(b+" timer is not defined");}this._addTimeline(a,b);return b},_addTimeline:function(a,b){a=parseInt(a,10);this._htAnimations[a]=this._htAnimations[a]||[];this._htAnimations[a].push(b);this._aTimeline!==null&&this.reset()},remove:function(a,b){a=parseInt(a,10);if(this._htAnimations&&this._htAnimations[a]){for(var c=0;c<this._htAnimations[a].length;c++)if(typeof b===
"undefined"||b===this._htAnimations[a][c]){this._htAnimations[a][c].stop();this._htAnimations[a].splice(c,1);c--;if(typeof b!=="undefined")break}if(this._htAnimations[a].length<1){delete this._htAnimations[a];this._removeTimelineStartTime(a)}}},_removeTimelineStartTime:function(a){if(this._aTimeline)for(var b=0,c=this._aTimeline.length;b<c;b++)if(this._aTimeline[b]===a){this._aTimeline.splice(b,1);break}},_initTimeline:function(){this._aTimeline=[];this._aRunningAnimation=[];for(var a in this._htAnimations)this._aTimeline.push(parseInt(a,
10));this._aTimeline.sort(function(b,c){return b-c})},getAnimation:function(a){a=parseInt(a,10);return this._htAnimations&&this._htAnimations[a]?this._htAnimations[a]:false},getRunningTime:function(){return this._nRunningTime||0},getCycle:function(){return this._nCountCycle||0},reset:function(){this._aRunningAnimation=this._aTimeline=this._nRunningTime=this._nFrameAtRunLastest=null;this._nCountCycle=0;this._initTimeline()},run:function(a,b){if(a===undefined)a=collie.Renderer.getInfo().frame;if(this._nFrameAtRunLastest>
a)this.reset();else{if(this._nFrameAtRunLastest===null){this._nFrameAtRunLastest=a;b=this._nRunningTime=0}this._nRunningTime+=b;if(this._aTimeline.length>0)for(;this._aTimeline[0]<=this._nRunningTime;)for(var c=this._aTimeline.shift(),d=0,e=this._htAnimations[c].length;d<e;d++){this._aRunningAnimation.push(this._htAnimations[c][d]);this._htAnimations[c][d].start()}if(this._aRunningAnimation.length>0)for(d=0;d<this._aRunningAnimation.length;d++){this._aRunningAnimation[d]&&this._aRunningAnimation[d].run(a,
b);if(!this._aRunningAnimation[d]||!this._aRunningAnimation[d].isPlaying()){this._aRunningAnimation[d]&&this._aRunningAnimation[d].reset();this._aRunningAnimation.splice(d,1);d--;this._checkComplete()}}}},_checkComplete:function(){if(this._aRunningAnimation.length<1&&this._aTimeline.length<1){this._nCountCycle++;if(this._htOption.loop&&this._htOption.loop<=this._nCountCycle)this.complete();else{this.fireEvent("end");this._aRunningAnimation=this._aTimeline=this._nRunningTime=this._nFrameAtRunLastest=
null;this._initTimeline()}}}},collie.Animation);
collie.AnimationQueue=collie.Class({$init:function(a){this.option("loop",1);this.option(a||{});this.setOptionEvent(a);this._aAnimations=[];this._fOnCompleteAnimation=this._onCompleteAnimation.bind(this);this.reset()},delay:function(a,b,c){this._add(new collie.AnimationDelay(a,b,c));return this},repeat:function(a,b,c){this._add(new collie.AnimationRepeat(a,b,c));return this},transition:function(a,b,c){this._add(new collie.AnimationTransition(a,b,c));return this},cycle:function(a,b,c){this._add(new collie.AnimationCycle(a,
b,c));return this},getAnimation:function(a){return this._aAnimations[a]||false},_add:function(a){a.attach("complete",this._fOnCompleteAnimation);this._aAnimations.push(a)},_onCompleteAnimation:function(){this.next()},next:function(){if(this._nAnimationIdx===null)this._nAnimationIdx=0;else this._nAnimationIdx++;if(this._nAnimationIdx>=this._aAnimations.length){this._nCount++;this.fireEvent("end",{count:this._nCount});if(!this._htOption.loop||this._htOption.loop>this._nCount)this._nAnimationIdx=0;else{this.complete();
return}}this._aAnimations[this._nAnimationIdx].stop();this._aAnimations[this._nAnimationIdx].start()},reset:function(){this._nAnimationIdx=this._nFrameAtRunLastest=null;this._nCount=0},removeAll:function(){this._aAnimations=[];this.reset()},removeAfter:function(){this._nAnimationIdx+1<=this._aAnimations.length-1&&this._aAnimations.splice(this._nAnimationIdx+1,this._aAnimations.length-(this._nAnimationIdx+1))},run:function(a,b){if(!(this._aAnimations.length<1)){if(a===undefined)a=collie.Renderer.getInfo().frame;
if(this._nFrameAtRunLastest>a)this.reset();else{if(this._nFrameAtRunLastest===null)this._nFrameAtRunLastest=a;this._nAnimationIdx===null&&this.next();this._aAnimations[this._nAnimationIdx].run(a,b)}}}},collie.Animation);
collie.TimerList=collie.Class({$init:function(){this._aList=[]},add:function(a){this._aList.unshift(a)},remove:function(a){for(var b=0,c=this._aList.length;b<c;b++)if(this._aList[b]===a){this._aList.splice(b,1);break}},removeAll:function(){this._aList=[]},stopAll:function(){for(var a=0,b=this._aList.length;a<b;a++)this._aList[a].stop()},run:function(a,b){for(var c=this._aList.length-1;c>=0;c--)if(this._aList[c])this._aList[c].isPlaying()?this._aList[c].run(a,b):this._aList.splice(c,1)}});
collie.Timer=collie.Timer||new (collie.Class({$init:function(){this._oList=new collie.TimerList},run:function(a,b){this._oList.run(a,b)},stopAll:function(){this._oList.stopAll()},removeAll:function(){this._oList.removeAll()},queue:function(a){a=new collie.AnimationQueue(a);a.setTimerList(this._oList);return a},repeat:function(a,b,c){a=new collie.AnimationRepeat(a,b,c);a.setTimerList(this._oList);return a},transition:function(a,b,c){a=new collie.AnimationTransition(a,b,c);a.setTimerList(this._oList);
return a},cycle:function(a,b,c){a=new collie.AnimationCycle(a,b,c);a.setTimerList(this._oList);return a},delay:function(a,b,c){a=new collie.AnimationDelay(a,b,c);a.setTimerList(this._oList);return a},timeline:function(a,b){var c=new collie.AnimationTimeline(a,b);c.setTimerList(this._oList);return c}}));
collie.Renderer=collie.Renderer||new (collie.Class({DEFAULT_FPS:"60fps",RETINA_DISPLAY:false,DEBUG_USE_DELAY:false,DEBUG_MAX_DELAY:200,DEBUG_RENDERING_MODE:"auto",$init:function(){this._sVisibilityChange=this._getNamePageVisibility();this._bPause=this._bPlaying=false;this._nSkippedFrame=this._nCurrentFrame=this._nDuration=this._nFPS=0;this._nBeforeFrameTime=null;this._nBeforeRenderingTime=0;this._aLayerList=[];this._fRender=this._render.bind(this);this._fCallback=null;this._htCallback={};this._elContainer=
document.createElement("div");this._elContainer.className="_collie_container";this._elContainer.style.position="relative";this._elContainer.style.overflow="hidden";this._elParent=null;this._nDebugDelayedTime=0;this._oRenderingTimer=null;this._bLoaded=false;this._bUseRetinaDisplay=this._sRenderingMode=null;this._htEventStatus={};this._htPosition={};this._bIsPreventDefault=true;this._htDeviceInfo=collie.util.getDeviceInfo();if(this._sVisibilityChange)collie.util.addEventListener(document,this._sVisibilityChange,
this._onChangeVisibility.bind(this));else if(!this._htDeviceInfo.desktop){collie.util.addEventListener(window,"pageshow",this._onPageShow.bind(this));collie.util.addEventListener(window,"pagehide",this._onPageHide.bind(this))}collie.util.addEventListener(window,"resize",this.refresh.bind(this))},_onPageShow:function(){!this.isPlaying()&&this._bPause&&this.resume()},_onPageHide:function(){this.isPlaying()&&this.pause()},_onChangeVisibility:function(){var a=document.visibilityState||document.webkitVisibilityState||
document.mozVisibilityState;if(a==="hidden")this.pause();else a==="visible"&&this.resume()},refresh:function(){if(this._elParent!==null)this._htPosition=collie.util.getPosition(this._elParent)},getPosition:function(){return this._bLoaded?this._htPosition:false},addLayer:function(a){if(!a||!("type"in a)||a.type!=="layer")throw Error("oLayer is not Layer instnace");for(var b=0,c=this._aLayerList.length;b<c;b++)if(this._aLayerList[b]===a)return;this._aLayerList.push(a);if(this._bLoaded){a.load(this._elContainer,
this._aLayerList.length);this.resetLayerEvent()}},removeLayer:function(a){for(var b=0,c=this._aLayerList.length;b<c;b++)if(this._aLayerList[b]===a){this._aLayerList[b].unload();this._aLayerList.splice(b,1);break}},removeAllLayer:function(){for(var a=this._aLayerList.length-1;a>=0;a--)this._aLayerList[a].unload();this._aLayerList=[]},getLayers:function(){return this._aLayerList},resetLayerEvent:function(){for(var a=0,b=this._aLayerList.length;a<b;a++)this._aLayerList[a].detachEvent();for(a=this._aLayerList.length-
1;a>=0;a--)this._aLayerList[a].attachEvent()},getElement:function(){return this._elContainer},getDuration:function(){return this._nDuration},getInfo:function(){this._htCallback.frame=this._nCurrentFrame;this._htCallback.skippedFrame=this._nSkippedFrame;this._htCallback.fps=this._nFPS;this._htCallback.duration=this._nDuration;this._htCallback.renderingTime=this._nBeforeRenderingTime;this._htCallback.beforeFrameTime=this._nBeforeFrameTime;return this._htCallback},getRenderingMode:function(){if(this._sRenderingMode===
null){var a=collie.util.getDeviceInfo();this._sRenderingMode=this.DEBUG_RENDERING_MODE;if(!this._sRenderingMode||this._sRenderingMode==="auto")this._sRenderingMode=a.android&&!a.chrome&&(a.android<4.2&&a.android>=3||a.android<2.2)||!a.supportCanvas||a.ios&&a.ios<5?"dom":"canvas";if(!a.supportCanvas)this._sRenderingMode="dom"}return this._sRenderingMode},setRenderingMode:function(a){this.DEBUG_RENDERING_MODE=a.toString().toLowerCase();this._sRenderingMode=null},isRetinaDisplay:function(){if(this._bUseRetinaDisplay===
null){this._bUseRetinaDisplay=this.RETINA_DISPLAY!=="auto"?this.RETINA_DISPLAY:window.devicePixelRatio>=2&&(!collie.util.getDeviceInfo().android||collie.util.getDeviceInfo().android>=4);var a=collie.util.getDeviceInfo();if(a.ie&&a.ie<9)this._bUseRetinaDisplay=false}return this._bUseRetinaDisplay},setRetinaDisplay:function(a){this.RETINA_DISPLAY=a;this._bUseRetinaDisplay=null},_getNameAnimationFrame:function(a){return typeof window.requestAnimationFrame!=="undefined"?a?"cancelAnimationFrame":"requestAnimationFrame":
typeof window.webkitRequestAnimationFrame!=="undefined"?a?"webkitCancelAnimationFrame":"webkitRequestAnimationFrame":typeof window.msRequestAnimationFrame!=="undefined"?a?"msCancelAnimationFrame":"msRequestAnimationFrame":typeof window.mozRequestAnimationFrame!=="undefined"?a?"mozCancelAnimationFrame":"mozRequestAnimationFrame":typeof window.oRequestAnimationFrame!=="undefined"?a?"oCancelAnimationFrame":"oRequestAnimationFrame":false},_getNamePageVisibility:function(){return"hidden"in document?"visibilitychange":
"webkitHidden"in document?"webkitvisibilitychange":"mozHidden"in document?"mozvisibilitychange":false},load:function(a){this.unload();this._bLoaded=true;this._elParent=a;this._elParent.appendChild(this._elContainer);this.refresh();if(this._aLayerList.length){a=0;for(var b=this._aLayerList.length;a<b;a++)this._aLayerList[a].load(this._elContainer,a);for(a=this._aLayerList.length-1;a>=0;a--)this._aLayerList[a].attachEvent()}},unload:function(){if(this._bLoaded){for(var a=0,b=this._aLayerList.length;a<
b;a++)this._aLayerList[a].unload();this._elParent.removeChild(this._elContainer);this._elParent=null;this._bLoaded=false}},start:function(a,b){if(!this._bPlaying){a=a||this.DEFAULT_FPS;this._nDuration=/fps$/i.test(a)?1E3/parseInt(a,10):Math.max(16,a);this._fCallback=b||null;this._bPlaying=true;if(this._nDuration<17){this._sRequestAnimationFrameName=this._getNameAnimationFrame();this._sCancelAnimationFrameName=this._getNameAnimationFrame(true)}else this._sCancelAnimationFrameName=this._sRequestAnimationFrameName=
false;this.fireEvent("start");this._trigger(0)}},_trigger:function(a){this._sVisibilityChange||window.screenTop<-3E4&&this.pause();a=typeof a==="undefined"?0:parseInt(a,10);this._oRenderingTimer=this._sRequestAnimationFrameName!==false&&!this.DEBUG_USE_DELAY?window[this._sRequestAnimationFrameName](this._fRender):setTimeout(this._fRender,a)},_render:function(a,b){if(this._bPlaying||b){var c=this._getDate(),d=0,e=1;if(this._nBeforeFrameTime!==null){d=c-this._nBeforeFrameTime;e=a||Math.max(1,Math.round(d/
this._nDuration));if(this._sRequestAnimationFrameName!==false)e=1;this._nSkippedFrame+=Math.max(0,e-1);this._nFPS=Math.round(1E3/(c-this._nBeforeFrameTime))}this._nCurrentFrame+=e;e=this.getInfo();if((this._fCallback===null||this._fCallback(e)!==false)&&this.fireEvent("process",e)!==false){collie.Timer.run(this._nCurrentFrame,d);this._update(d);d=0;if(this.DEBUG_USE_DELAY){d=Math.round(Math.random()*this.DEBUG_MAX_DELAY);this._nDebugDelayedTime+=d}this._nBeforeRenderingTime=this._getDate()-c;this._nBeforeFrameTime=
c;this._bPlaying&&this._trigger(Math.max(0,this._nDuration-this._nBeforeRenderingTime+d*2))}else this.stop()}},draw:function(a){this._fRender(a,true)},_getDate:function(){return+new Date+(this.DEBUG_USE_DELAY?this._nDebugDelayedTime:0)},stop:function(){if(this._bPlaying){this._bPlaying=false;this._resetTimer();this.fireEvent("stop",this.getInfo());this._fCallback=this._bUseRetinaDisplay=this._sRenderingMode=null;this._nSkippedFrame=this._nBeforeRenderingTime=this._nCurrentFrame=0;this._nBeforeFrameTime=
null}},_resetTimer:function(){if(this._oRenderingTimer!==null){if(this._sCancelAnimationFrameName!==false)window[this._sCancelAnimationFrameName](this._oRenderingTimer);else clearTimeout(this._oRenderingTimer);window.tempTimer=window.tempTimer||[];window.tempTimer.push(this._oRenderingTimer);this._oRenderingTimer=null}},pause:function(){if(this._bPlaying){this._bPlaying=false;this._bPause=true;this.fireEvent("pause",this.getInfo());this._resetTimer()}},resume:function(){if(this._bPause){this._nBeforeFrameTime=
this._getDate();this._nBeforeRenderingTime=0;this._bPlaying=true;this._bPause=false;this.fireEvent("resume",this.getInfo());this._trigger(0)}},isPlaying:function(){return this._bPlaying},_update:function(a){for(var b=0,c=this._aLayerList.length;b<c;b++)this._aLayerList[b].update(a)},setEventStatus:function(a,b){this._htEventStatus={type:a,firedOnTarget:b}},isStopEvent:function(a){if(a==="click")a="mouseup";return a===this._htEventStatus.type&&this._htEventStatus.firedOnTarget},getEventStatus:function(){return this._htEventStatus},
setPreventDefault:function(a){this._bIsPreventDefault=!!a},isPreventDefault:function(){return this._bIsPreventDefault},resize:function(a,b,c){for(var d=0,e=this._aLayerList.length;d<e;d++)this._aLayerList[d].resize(a,b,c)}},collie.Component));